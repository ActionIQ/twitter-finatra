<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HTTP Requests &#8212; Finatra 19.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '19.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Finatra 19.3.0 documentation" href="../../index.html" />
    <link rel="up" title="User’s Guide" href="../index.html" />
    <link rel="next" title="HTTP Responses" href="responses.html" />
    <link rel="prev" title="Defining HTTP Controllers" href="controllers.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="responses.html" title="HTTP Responses"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="controllers.html" title="Defining HTTP Controllers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User&#8217;s Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="http-requests">
<span id="id1"></span><h1>HTTP Requests<a class="headerlink" href="#http-requests" title="Permalink to this headline">¶</a></h1>
<p>Each Finatra <a class="reference external" href="controllers.html">HTTP Controller</a> route has a callback function which is executed
when the defined route matches an incoming request URI. Callbacks require explicit input types and
Finatra will try to convert the incoming request into the specified input type. Finatra supports three
callback function input types: <a class="reference external" href="#finagle-c-t-finagle-http-request">a Finagle HTTP Request</a>, a
custom <a class="reference external" href="#custom-request-case-class">request case class</a>, or a type parsable by a
<a class="reference external" href="#message-body-components">message body reader</a>. Each are detailed below.</p>
<div class="section" id="finagle-c-t-finagle-http-request">
<h2>Finagle <cite>c.t.finagle.http.Request</cite><a class="headerlink" href="#finagle-c-t-finagle-http-request" title="Permalink to this headline">¶</a></h2>
<p>This is a <a class="reference external" href="https://twitter.github.io/finagle/docs/index.html#com.twitter.finagle.http.Request">c.t.finagle.http.Request</a>
which contains common HTTP attributes.</p>
</div>
<div class="section" id="custom-request-case-class">
<h2>Custom &#8220;request&#8221; case class<a class="headerlink" href="#custom-request-case-class" title="Permalink to this headline">¶</a></h2>
<p>Custom &#8220;request&#8221; case classes can be used for declarative parsing of requests with a content-type of
<cite>application/json</cite> with support for type conversions, default values, and <a class="reference external" href="../json/validations.html">validations</a>.</p>
<p>The case class field names should match the request or header parameter name or use the <a class="reference external" href="https://github.com/FasterXML/jackson-annotations#annotations-for-renaming-properties">&#64;JsonProperty</a>
annotation to specify the JSON field name in the case class (see: <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/test/scala/com/twitter/finatra/json/tests/internal/ExampleCaseClasses.scala#L177">example</a>
and <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/test/scala/com/twitter/finatra/json/tests/FinatraObjectMapperTest.scala#L140">test case</a>).</p>
<p>A <a class="reference external" href="https://fasterxml.github.io/jackson-databind/javadoc/2.3.0/com/fasterxml/jackson/databind/PropertyNamingStrategy.html">PropertyNamingStrategy</a>
can be configured to handle common name substitutions (e.g. snake_case or camelCase). By default,
snake_case is used (defaults are set in <a class="reference external" href="https://github.com/twitter/finatra/tree/master/jackson/src/main/scala/com/twitter/finatra/json/modules/FinatraJacksonModule.scala">FinatraJacksonModule</a>).</p>
<p>For example, if we have a <cite>POST</cite> endpoint which expects a JSON body with a <cite>Long</cite> <cite>&#8220;id&#8221;</cite> and a
<cite>String</cite> <cite>&#8220;name&#8221;</cite>, we could define the following case class and Controller route:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>case class HiRequest(id: Long, name: String)

...

post(&quot;/hi&quot;) { hiRequest: HiRequest =&gt;
  &quot;Hello &quot; + hiRequest.name + &quot; with id &quot; + hiRequest.id
}
</pre></div>
</div>
<p>For the request: <code class="docutils literal"><span class="pre">POST</span> <span class="pre">/hi</span></code></p>
<div class="code json highlight-text"><div class="highlight"><pre><span></span>{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Bob&quot;
}
</pre></div>
</div>
<p>The incoming request body will be parsed as JSON using the configured <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/json/FinatraObjectMapper.scala">FinatraObjectMapper</a>
into the <cite>HiRequest</cite> case class. This route would thus return:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">statuscode 200:</th><td class="field-body"><cite>Hello Bob with id 1</cite></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>More examples in the <a class="reference external" href="../json/routing.html#json-integration-with-routing">JSON Integration with Routing</a>
section.</p>
<p>For more information on configuring the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/json/FinatraObjectMapper.scala">FinatraObjectMapper</a>
see the <a class="reference external" href="../json/index.html">Jackson Integration</a> section.</p>
<div class="section" id="required-fields">
<h3>Required Fields<a class="headerlink" href="#required-fields" title="Permalink to this headline">¶</a></h3>
<p><strong>Non-option fields without default values are considered required.</strong></p>
<p>If a required field is missing, a <cite>CaseClassMappingException</cite> is thrown.</p>
</div>
<div class="section" id="field-annotations">
<h3>Field Annotations<a class="headerlink" href="#field-annotations" title="Permalink to this headline">¶</a></h3>
<p>Field annotations give signal as to how the framework should parse a case class field member from
the <cite>c.t.finagle.http.Request</cite>. Supported annotations:</p>
<ul class="simple">
<li><a class="reference external" href="#routeparam">&#64;RouteParam</a></li>
<li><a class="reference external" href="#queryparam">&#64;QueryParam</a></li>
<li><a class="reference external" href="#formparam">&#64;FormParam</a></li>
<li><a class="reference external" href="#header">&#64;Header</a></li>
<li><a class="reference external" href="#inject">&#64;Inject</a></li>
</ul>
<hr class="docutils" />
<div class="section" id="routeparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/java/com/twitter/finatra/request/RouteParam.java">&#64;RouteParam</a><a class="headerlink" href="#routeparam" title="Permalink to this headline">¶</a></h4>
<p>Denotes a field to be parsed from a named parameter in a given route, e.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>case class FromRouteRequest(
  @RouteParam(&quot;entity&quot;) resource: String,
  @RouteParam id: String)


get(&quot;/foo/:entity/:id&quot;) { request: FromRouteRequest =&gt;
  s&quot;The resource is ${request.resource} and the id = ${request.id}&quot;
}
</pre></div>
</div>
<p>Given a request: <code class="docutils literal"><span class="pre">GET</span> <span class="pre">/foo/users/1234</span></code></p>
<p>Using <cite>FromRouteRequest</cite> as an input to the route callback would parse the string &#8220;users&#8221; into the
value of <cite>FromRouteRequest#resource</cite> and the string &#8220;1234&#8221; into the value of <cite>FromRouteRequest#id</cite>.</p>
<p>Thus, this route would respond:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">statuscode 200:</th><td class="field-body"><cite>The resource is users and the id = 1234</cite></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/IdAndNameRequest.scala">example</a>.</p>
</div>
<hr class="docutils" />
<div class="section" id="queryparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/java/com/twitter/finatra/request/QueryParam.java">&#64;QueryParam</a><a class="headerlink" href="#queryparam" title="Permalink to this headline">¶</a></h4>
<p>Read a value from the request query string by a parameter named for the case class field or by the
<code class="docutils literal"><span class="pre">&#64;QueryParam</span></code> annotation value.</p>
<p>For example, suppose you want to parse a <cite>GET</cite> request with three query params: <cite>max</cite>, <cite>startDate</cite>,
and <cite>verbose</cite>, e.g.,</p>
<p><code class="docutils literal"><span class="pre">GET</span> <span class="pre">/users?max=10&amp;start_date=2014-05-30TZ&amp;verbose=true</span></code></p>
<p>This can be modeled with the following custom &#8220;request&#8221; case class which also applies
<a class="reference external" href="../json/validations.html">validations</a>:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>case class UsersRequest(
  @Max(100) @QueryParam max: Int,
  @PastDate @QueryParam startDate: Option[DateTime],
  @QueryParam verbose: Boolean = false)

get(&quot;/users&quot;) { request: UsersRequest =&gt;
  ???
}
</pre></div>
</div>
<p>The <cite>max</cite> value will be parsed into an <cite>Int</cite> and <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/main/scala/com/twitter/finatra/json/internal/caseclass/validation/validators/MaxValidator.scala#L49">validated to be less than or equal to
100</a>.
The <cite>startDate</cite> will be parsed into an <cite>Option[DateTime]</cite> (meaning it could be omitted without error
from the query string) and if present will be validated to be a date in the past. Lastly, the
<cite>verbose</cite> parameter will be parsed into a <cite>Boolean</cite> type.</p>
<p>You can also set the parameter name as a value in the <code class="docutils literal"><span class="pre">&#64;QueryParam</span></code> annotation, e.g.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>case class QueryParamRequest(
  @QueryParam foo: String,
  @QueryParam(&quot;skip&quot;) isSkipped: Boolean)
</pre></div>
</div>
<p>Using this case class in a route callback for a request:</p>
<p><code class="docutils literal"><span class="pre">GET</span> <span class="pre">/?foo=bar&amp;skip=false</span></code></p>
<p>would parse the string &#8220;bar&#8221; into the value of <cite>QueryParamRequest#foo</cite> and parse the string &#8220;false&#8221;
as a Boolean into the <cite>QueryParamRequest#isSkipped</cite> field.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/RequestWithQueryParamSeqString.scala">example</a>.</p>
</div>
<hr class="docutils" />
<div class="section" id="formparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/java/com/twitter/finatra/request/FormParam.java">&#64;FormParam</a><a class="headerlink" href="#formparam" title="Permalink to this headline">¶</a></h4>
<p>Read a value from a form field with the case class field&#8217;s name or as the value specified in the
<code class="docutils literal"><span class="pre">&#64;FormParam</span></code> annotation from the request body.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/FormPostRequest.scala">example</a>.</p>
</div>
<hr class="docutils" />
<div class="section" id="header">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/java/com/twitter/finatra/request/Header.java">&#64;Header</a><a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h4>
<p>Read a header value specified by the case class field name or by the <code class="docutils literal"><span class="pre">&#64;Header</span></code> annotation value.
You can use a Scala <a class="reference external" href="http://www.scala-lang.org/files/archive/spec/2.11/01-lexical-syntax.html">&#8220;back-quote&#8221; literal</a>
for the field name when special characters are involved.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>@Header `user-agent`: String
</pre></div>
</div>
<p>or specify the header name as a parameter to the <code class="docutils literal"><span class="pre">&#64;Header</span></code> annotation, e.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>@Header(&quot;user-agent&quot;) agent: String
</pre></div>
</div>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/CreateUserRequest.scala">example</a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>Route, query, and form params are all stored in the &#8220;params&#8221; field of the incoming Finagle http
request. As such, you should ensure that <code class="docutils literal"><span class="pre">&#64;RouteParam</span></code> names do not collide with <code class="docutils literal"><span class="pre">&#64;QueryParam</span></code>
names. Otherwise, an <code class="docutils literal"><span class="pre">&#64;QueryParam</span></code> could end up parsing an <code class="docutils literal"><span class="pre">&#64;RouteParam</span></code> or <code class="docutils literal"><span class="pre">&#64;FormParam</span></code>
field.</p>
<p>Also note that request parameters and headers are accessed <strong>case-insensitively</strong>. Thus, the
annotated fields:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>@Header(&quot;Accept-Charset&quot;) acceptCharset: String
@Header(&quot;accept-charset&quot;) acceptCharset: String
@Header(&quot;aCcEpT-cHaRsEt&quot;) acceptCharset: String
@Header `accept-charset`: String
</pre></div>
</div>
<p class="last">would all retrieve <strong>the same value</strong> from the request headers map. The same is true for
<code class="docutils literal"><span class="pre">&#64;RouteParam</span></code>, <code class="docutils literal"><span class="pre">&#64;QueryParam</span></code>, and <code class="docutils literal"><span class="pre">&#64;FormParam</span></code>.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="inject">
<h4>&#64;Inject<a class="headerlink" href="#inject" title="Permalink to this headline">¶</a></h4>
<p>Can be used to inject any <a class="reference external" href="https://github.com/google/guice">Guice</a> managed class into your case
class.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>case class InjectedFieldCaseClass(
  @Inject defaultOptString: Option[String],
  @Inject foo Foo)
</pre></div>
</div>
<p>Note, however, it is not necessary to &#8220;inject&#8221; the underlying Finagle <cite>http</cite> Request into your
case class. To access the underlying Finagle HTTP Request in your custom case class, simply
include a field of type <cite>c.t.finagle.http.Request</cite> and the framework will properly inject the
incoming request into your custom case class, for example:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.finagle.http.Request

case class CaseClassWithRequestField(
 @Header(&quot;user-agent&quot;) agent: String,
 @QueryParam verbose: Boolean = false,
 request: Request)
</pre></div>
</div>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/RequestWithInjections.scala">example</a>.</p>
<hr class="docutils" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>HTTP requests with a content-type of <cite>application/json</cite> sent to routes with a custom request
case class callback input type will <strong>always trigger</strong> the parsing of the request body as
well-formed JSON in attempt to convert the JSON into the request case class.</p>
<p class="last">This behavior can be disabled by annotating the case class with <code class="docutils literal"><span class="pre">&#64;JsonIgnoreBody</span></code> leaving the
raw request body accessible by simply adding a member of type <cite>c.t.finagle.http.Request</cite> as
mentioned above.</p>
</div>
<p>For more specifics on how JSON parsing integrates with routing see the
<a class="reference external" href="../json/routing.html">JSON Integration with Routing</a> in the <a class="reference external" href="../json/index.html">JSON</a> documentation.</p>
</div>
</div>
</div>
<div class="section" id="message-body-components">
<h2>Message Body Components<a class="headerlink" href="#message-body-components" title="Permalink to this headline">¶</a></h2>
<p>Finatra also provides a way to specify how to parse the request into a callback function input via a
<a class="reference external" href="message_body.html#message-body-readers">Message Body Reader</a>. Similar to <a class="reference external" href="#custom-request-case-class">custom request case
classes</a> (which are implemented with a framework
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/internal/marshalling/DefaultMessageBodyReaderImpl.scala">default message body reader</a>),
these objects allow for customized parsing the full incoming <cite>c.t.finagle.http.Request</cite> into a
specific type. For more information, see the <a class="reference external" href="message_body.html#message-body-readers">Message Body Readers</a>
section.</p>
</div>
<div class="section" id="request-forwarding">
<h2>Request Forwarding<a class="headerlink" href="#request-forwarding" title="Permalink to this headline">¶</a></h2>
<p>You can forward a request to another controller. This is similar to other frameworks where
forwarding will re-use the same request as opposed to issuing a redirect which will force a client
to issue a new request.</p>
<p>To forward, you need to include a <cite>c.t.finatra.http.request.HttpForward</cite> instance in your controller,
e.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.finagle.http.Request
import com.twitter.finatra.http.Controller

class MyController @Inject()(
  forward: HttpForward)
  extends Controller {
</pre></div>
</div>
<p>Then, to use in your route:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>get(&quot;/foo&quot;) { request: Request =&gt;
  forward(request, &quot;/bar&quot;)
}
</pre></div>
</div>
<p>Forwarded requests will bypass the server defined filter chain (as the requests have already passed
through the filter chain) but will still pass through controller defined filters.</p>
<p>For example, if a route is defined:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>filter[MyAwesomeFilter].get(&quot;/bar&quot;) { request: Request =&gt;
  &quot;Hello, world.&quot;
}
</pre></div>
</div>
<p>When another controller forwards to this route, <cite>MyAwesomeFilter</cite> will be executed on the forwarded
request.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>By default Finatra sets a maximum forward depth of 5. This value is configurable by setting the
<cite>HttpRouter#withMaxRequestForwardingDepth</cite>. This helps prevent a given request from being
forwarded in an infinite loop.</p>
<p>In the example below, the server has been setup to allow a request to forward a maximum of 10 times.</p>
<div class="code scala last highlight-text"><div class="highlight"><pre><span></span>override def configureHttp(router: HttpRouter) {
  router
    .withMaxRequestForwardingDepth(10)
    .add[MyController]
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="multipart-requests">
<h2>Multipart Requests<a class="headerlink" href="#multipart-requests" title="Permalink to this headline">¶</a></h2>
<p>Finatra has support for multi-part requests. Here&#8217;s an example of a multi-part <cite>POST</cite> controller
route definition that simply returns all of the keys in the multi-part request:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>post(&quot;/multipartParamsEcho&quot;) { request: Request =&gt;
  RequestUtils.multiParams(request).keys
}
</pre></div>
</div>
<p>An example of testing this endpoint:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>def deserializeRequest(name: String) = {
  val requestBytes = IOUtils.toByteArray(getClass.getResourceAsStream(name))
  HttpCodec.decodeBytesToRequest(requestBytes)
}

&quot;post multipart&quot; in {
  val request = deserializeRequest(&quot;/multipart/request-POST-android.bytes&quot;)
  request.uri = &quot;/multipartParamsEcho&quot;

  server.httpRequest(
    request = request,
    suppress = true,
    andExpect = Ok,
    withJsonBody = &quot;&quot;&quot;[&quot;banner&quot;]&quot;&quot;&quot;)
}
</pre></div>
</div>
</div>
<div class="section" id="json-patch-requests">
<h2>JSON Patch Requests<a class="headerlink" href="#json-patch-requests" title="Permalink to this headline">¶</a></h2>
<p>Finatra has support for JSON Patch requests, see <a class="reference external" href="https://tools.ietf.org/html/rfc6902">JSON Patch definition</a>.</p>
<p>To handle JSON Patch requests, you will first need to register the <cite>JsonPatchMessageBodyReader</cite> and
the <cite>JsonPatchExceptionMapper</cite> in the server. The <cite>JsonPatchMessageBodyReader</cite> is for parsing JSON
Patch requests as type <cite>c.t.finatra.http.jsonpatch.JsonPatch</cite>, and <cite>JsonPatchExceptionMapper</cite> can
convert JsonPatchExceptions to HTTP responses.</p>
<p>See <a class="reference external" href="exceptions.html">Add an ExceptionMapper</a> for more information on exception mappers.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.finatra.http.HttpServer
import com.twitter.finatra.http.routing.HttpRouter

class ExampleServer extends HttpServer {

 override def configureHttp(router: HttpRouter): Unit = {
   router
     .register[JsonPatchMessageBodyReader]
     .exceptionMapper[JsonPatchExceptionMapper]
     .add[ExampleController]
 }
}
</pre></div>
</div>
<p>Next, you should include a <cite>c.t.finatra.http.jsonpatch.JsonPatchOperator</cite> instance in your controller,
which provides <cite>JsonPatchOperator#toJsonNode</cite> conversions and support for all JSON Patch operations.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.finatra.http.Controller

class MyController @Inject()(
  jsonPatchOperator: JsonPatchOperator
) extends Controller {
  ???
}
</pre></div>
</div>
<p>After the target data has been converted to a JsonNode, just call <cite>JsonPatchUtility.operate</cite> to apply
JSON Patch operations to the target.</p>
<p>For example:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>patch(&quot;/jsonPatch&quot;) { jsonPatch: JsonPatch =&gt;
  val testCase = ExampleCaseClass(&quot;world&quot;)
  val originalJson = jsonPatchOperator.toJsonNode[ExampleCaseClass](testCase)
  JsonPatchUtility.operate(jsonPatch.patches, jsonPatchOperator, originalJson)
}
</pre></div>
</div>
<p>An example of testing this endpoint:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>&quot;JsonPatch&quot; in {
  val request = RequestBuilder.patch(&quot;/jsonPatch&quot;)
    .body(
      &quot;&quot;&quot;[
        |{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/fruit&quot;,&quot;value&quot;:&quot;orange&quot;},
        |{&quot;op&quot;:&quot;remove&quot;,&quot;path&quot;:&quot;/hello&quot;},
        |{&quot;op&quot;:&quot;copy&quot;,&quot;from&quot;:&quot;/fruit&quot;,&quot;path&quot;:&quot;/veggie&quot;},
        |{&quot;op&quot;:&quot;replace&quot;,&quot;path&quot;:&quot;/veggie&quot;,&quot;value&quot;:&quot;bean&quot;},
        |{&quot;op&quot;:&quot;move&quot;,&quot;from&quot;:&quot;/fruit&quot;,&quot;path&quot;:&quot;/food&quot;},
        |{&quot;op&quot;:&quot;test&quot;,&quot;path&quot;:&quot;/food&quot;,&quot;value&quot;:&quot;orange&quot;}
        |]&quot;&quot;&quot;.stripMargin,
      contentType = Message.ContentTypeJsonPatch)

  server.httpRequestJson[JsonNode](
    request = request,
    andExpect = Ok,
    withJsonBody = &quot;&quot;&quot;{&quot;food&quot;:&quot;orange&quot;,&quot;veggie&quot;:&quot;bean&quot;}&quot;&quot;&quot;)
}
</pre></div>
</div>
<p>For more information and examples, see:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/request/RequestUtils.scala">c.t.finatra.http.request.RequestUtils</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/fileupload/MultipartItem.scala">c.t.finatra.http.fileupload.MultipartItem</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/controllers/DoEverythingController.scala">DoEverythingController</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/test/DoEverythingServerFeatureTest.scala">DoEverythingServerFeatureTest</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/request/MultiParamsTest.scala">MultiParamsTest</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTTP Requests</a><ul>
<li><a class="reference internal" href="#finagle-c-t-finagle-http-request">Finagle <cite>c.t.finagle.http.Request</cite></a></li>
<li><a class="reference internal" href="#custom-request-case-class">Custom &#8220;request&#8221; case class</a><ul>
<li><a class="reference internal" href="#required-fields">Required Fields</a></li>
<li><a class="reference internal" href="#field-annotations">Field Annotations</a><ul>
<li><a class="reference internal" href="#routeparam">&#64;RouteParam</a></li>
<li><a class="reference internal" href="#queryparam">&#64;QueryParam</a></li>
<li><a class="reference internal" href="#formparam">&#64;FormParam</a></li>
<li><a class="reference internal" href="#header">&#64;Header</a></li>
<li><a class="reference internal" href="#inject">&#64;Inject</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#message-body-components">Message Body Components</a></li>
<li><a class="reference internal" href="#request-forwarding">Request Forwarding</a></li>
<li><a class="reference internal" href="#multipart-requests">Multipart Requests</a></li>
<li><a class="reference internal" href="#json-patch-requests">JSON Patch Requests</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User&#8217;s Guide</a><ul>
      <li>Previous: <a href="controllers.html" title="previous chapter">Defining HTTP Controllers</a></li>
      <li>Next: <a href="responses.html" title="next chapter">HTTP Responses</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2013-2019 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>