
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Jackson Integration &#8212; Finatra 21.10.0 documentation</title>
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="JSON Integration with HTTP Routing" href="routing.html" />
    <link rel="prev" title="Validation Framework Integration" href="../validation/index.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="routing.html" title="JSON Integration with HTTP Routing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../validation/index.html" title="Validation Framework Integration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User’s Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="jackson-integration">
<span id="json"></span><h1>Jackson Integration<a class="headerlink" href="#jackson-integration" title="Permalink to this headline">¶</a></h1>
<p>Finatra builds upon the <a class="reference external" href="http://twitter.github.io/util">TwitterUtil</a> Jackson <a class="reference external" href="http://twitter.github.io/util/guide/util-jackson/index.html">library</a> for <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a>
which provides a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala">c.t.util.jackson.ScalaObjectMapper</a>.
See the <a class="reference external" href="http://twitter.github.io/util/guide/util-jackson/index.html">User Guide</a> for details about the <a class="reference external" href="http://twitter.github.io/util">TwitterUtil</a> Jackson library.</p>
<div class="admonition-this-documentation-assumes-some-level-of-familiarity-with-jackson-json-processing-library-https-github-com-fasterxml-jackson admonition">
<p class="first admonition-title">🚨 This documentation assumes some level of familiarity with <a class="reference external" href="https://github.com/FasterXML/jackson">Jackson JSON Processing library</a></p>
<p>Specifically Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind#1-minute-tutorial-pojos-to-json-and-back">databinding</a>
and the Jackson <a class="reference external" href="http://fasterxml.github.io/jackson-databind/javadoc/2.10/com/fasterxml/jackson/databind/ObjectMapper.html">ObjectMapper</a>.</p>
<p>There are several <a class="reference external" href="https://github.com/FasterXML/jackson-docs#tutorials">tutorials</a> (and <a class="reference external" href="https://github.com/FasterXML/jackson-docs#external-off-github-documentation">external documentation</a>)
which may be useful if you are unfamiliar with Jackson.</p>
<p class="last">Additionally, you may want to familiarize yourself with the <a class="reference external" href="https://github.com/FasterXML/jackson-docs#annotations">Jackson Annotations</a>
as they allow for finer-grain customization of Jackson databinding.</p>
</div>
<div class="section" id="case-classes">
<h2>Case Classes<a class="headerlink" href="#case-classes" title="Permalink to this headline">¶</a></h2>
<p>As mentioned, <a class="reference external" href="https://github.com/FasterXML/jackson">Jackson</a> is a JSON processing library. We
generally use Jackson for <a class="reference external" href="https://www.tutorialspoint.com/jackson/jackson_data_binding.htm">databinding</a>,
or more specifically:</p>
<ul class="simple">
<li>object serialization: converting an object <strong>into a JSON String</strong> and</li>
<li>object deserialization: converting a JSON String <strong>into an object</strong></li>
</ul>
<p>The TwitterUtil Jackson integration is primarily centered around serializing and deserializing Scala
<a class="reference external" href="https://docs.scala-lang.org/tour/case-classes.html">case classes</a>. This is because Scala
<a class="reference external" href="https://docs.scala-lang.org/tour/case-classes.html">case classes</a> map well to the two JSON
structures [<a class="reference external" href="https://www.json.org/json-en.html">reference</a>]:</p>
<ul class="simple">
<li>A collection of name/value pairs. Generally termed an <em>object</em>. Here, the name/value pairs are the case field name to field value but can also be an actual Scala <cite>Map[T, U]</cite> as well.</li>
<li>An ordered list of values. Typically an <em>array</em>, <em>vector</em>, <em>list</em>, or <em>sequence</em>, which for case classes can be represented by a Scala <cite>Iterable</cite>.</li>
</ul>
<div class="section" id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>Here we outline some simple usage patterns. More examples can be found in the TwitterUtil
<a class="reference external" href="http://twitter.github.io/util/guide/util-jackson/index.html">User Guide</a>.</p>
<p>Let’s assume we have these two case classes:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>case class Bar(d: String)
case class Foo(a: String, b: Int, c: Bar)
</pre></div>
</div>
<p>To <strong>serialize</strong> a case class into a JSON string, use</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>ScalaObjectMapper#writeValueAsString(any: Any): String
</pre></div>
</div>
<p>For example:</p>
<p>To <strong>deserialize</strong> a JSON string into a case class, use</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>ScalaObjectMapper#parse[T](s: String): T
</pre></div>
</div>
<p>For example, assuming the same <cite>Bar</cite> and <cite>Foo</cite> case classes defined above:</p>
<p>You can find many examples of using the <cite>ScalaObjectMapperModule</cite> in the various framework tests:</p>
<ul class="simple">
<li>Scala examples [<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/test/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModuleTest.scala">1</a>, <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/test/scala/com/twitter/finatra/jackson/ScalaObjectMapperTest.scala">2</a>].</li>
<li>Java <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/test/java/com/twitter/finatra/jackson/tests/ScalaObjectMapperModuleJavaTest.java">example</a>.</li>
</ul>
<p>As mentioned above, there is also a plethora of Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-docs#tutorials">tutorials</a> and <a class="reference external" href="https://github.com/FasterXML/jackson-docs#external-off-github-documentation">HOW-TOs</a>
available online which provide more in-depth examples of how to use a Jackson <a class="reference external" href="http://fasterxml.github.io/jackson-databind/javadoc/2.10/com/fasterxml/jackson/databind/ObjectMapper.html">ObjectMapper</a>.</p>
</div>
</div>
<div class="section" id="twitterutil-scalaobjectmapper">
<h2>TwitterUtil <cite>ScalaObjectMapper</cite><a class="headerlink" href="#twitterutil-scalaobjectmapper" title="Permalink to this headline">¶</a></h2>
<p>The TwitterUtil <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> is a thin wrapper around a configured <a class="reference external" href="https://github.com/FasterXML/jackson-module-scala"><cite>jackson-module-scala</cite></a>
<a class="reference external" href="https://github.com/FasterXML/jackson-module-scala/blob/master/src/main/scala-2.+/com/fasterxml/jackson/module/scala/ScalaObjectMapper.scala">com.fasterxml.jackson.module.scala.ScalaObjectMapper</a>.
In Finatra, the recommended way to construct a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> is via the Finatra <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>.</p>
<div class="section" id="c-t-f-jackson-modules-scalaobjectmappermodule">
<h3>c.t.f.jackson.modules.ScalaObjectMapperModule<a class="headerlink" href="#c-t-f-jackson-modules-scalaobjectmappermodule" title="Permalink to this headline">¶</a></h3>
<p>Finatra provides the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>, a <a class="reference external" href="../getting-started/modules.html">c.t.inject.TwitterModule</a>,
which is the recommended way to configure and bind a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> to the object graph. This
is similar to the <a class="reference external" href="https://github.com/FasterXML/jackson-modules-base/tree/master/guice">jackson-module-guice</a>
<a class="reference external" href="https://github.com/FasterXML/jackson-modules-base/blob/master/guice/src/main/java/com/fasterxml/jackson/module/guice/ObjectMapperModule.java">ObjectMapperModule</a>
but uses Finatra’s <a class="reference external" href="../getting-started/modules.html">TwitterModule</a>.</p>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> provides bound instances of:</p>
<ul class="simple">
<li>a <a class="reference external" href="https://fasterxml.github.io/jackson-core/javadoc/2.11/com/fasterxml/jackson/core/JsonFactory.html">JsonFactory</a> configured <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> as a <cite>Singleton</cite>.</li>
<li>a <a class="reference external" href="https://fasterxml.github.io/jackson-core/javadoc/2.11/com/fasterxml/jackson/core/JsonFactory.html">JsonFactory</a> <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> with a <cite>PropertyNamingStrategy</cite> of <cite>camelCase</cite> as a <cite>Singleton</cite>.</li>
<li>a <a class="reference external" href="https://fasterxml.github.io/jackson-core/javadoc/2.11/com/fasterxml/jackson/core/JsonFactory.html">JsonFactory</a> <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> with a <cite>PropertyNamingStrategy</cite> of <cite>snake_case</cite> as a <cite>Singleton</cite>.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Generally, you are encouraged to obtain a reference to the <cite>Singleton</cite> instance provided by the
object graph over instantiating a new mapper. This is to ensure usage of a consistently configured
mapper across your application.</p>
</div>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> provides overridable methods which mirror the
<cite>ScalaObjectMapper#Builder</cite> for configuring the bound mappers.</p>
<p>For example, to create a <a class="reference external" href="../getting-started/modules.html">c.t.inject.TwitterModule</a>  which sets
the <cite>PropertyNamingStrategy</cite> different than the default:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.fasterxml.jackson.databind.PropertyNamingStrategy
import com.twitter.finatra.jackson.modules.ScalaObjectMapperModule

object MyCustomObjectMapperModule extends ScalaObjectMapperModule {

    override val propertyNamingStrategy: PropertyNamingStrategy =
      new PropertyNamingStrategy.KebabCaseStrategy
}
</pre></div>
</div>
<p>Or to set additional modules or configuration:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.fasterxml.jackson.databind.{
  DeserializationFeature,
  Module,
  ObjectMapper,
  PropertyNamingStrategy
}
import com.twitter.finatra.jackson.modules.ScalaObjectMapperModule

object MyCustomObjectMapperModule extends ScalaObjectMapperModule {

    override val propertyNamingStrategy: PropertyNamingStrategy =
      new PropertyNamingStrategy.KebabCaseStrategy

    override val additionalJacksonModules: Seq[Module] =
      Seq(MySimpleJacksonModule)

    override def additionalMapperConfiguration(mapper: ObjectMapper): Unit = {
      mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, true)
    }
}
</pre></div>
</div>
<p>See the <a class="reference external" href="../getting-started/modules.html#module-configuration-in-servers">Modules Configuration in Servers</a>
or the HTTP Server <a class="reference external" href="../http/server.html#framework-modules">Framework Modules</a> for more information
on how to make use of any custom <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>.</p>
</div>
<div class="section" id="c-t-f-jackson-modules-yamlscalaobjectmappermodule">
<h3>c.t.f.jackson.modules.YamlScalaObjectMapperModule<a class="headerlink" href="#c-t-f-jackson-modules-yamlscalaobjectmappermodule" title="Permalink to this headline">¶</a></h3>
<p>Finatra also provides the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/YamlScalaObjectMapperModule.scala"><cite>YamlScalaObjectMapperModule</cite></a> which is an extension of the
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> that can be used to configure and bind a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> using a
Jackson <a class="reference external" href="https://fasterxml.github.io/jackson-dataformats-text/javadoc/yaml/2.11/com/fasterxml/jackson/dataformat/yaml/YAMLFactory.html">YAMLFactory</a>
instead of a <a class="reference external" href="https://fasterxml.github.io/jackson-core/javadoc/2.11/com/fasterxml/jackson/core/JsonFactory.html">JsonFactory</a>.</p>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/YamlScalaObjectMapperModule.scala"><cite>YamlScalaObjectMapperModule</cite></a> provides bound instances of:</p>
<ul class="simple">
<li>a <a class="reference external" href="https://fasterxml.github.io/jackson-dataformats-text/javadoc/yaml/2.11/com/fasterxml/jackson/dataformat/yaml/YAMLFactory.html">YAMLFactory</a> configured <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> as a <cite>Singleton</cite>.</li>
<li>a <a class="reference external" href="https://fasterxml.github.io/jackson-dataformats-text/javadoc/yaml/2.11/com/fasterxml/jackson/dataformat/yaml/YAMLFactory.html">YAMLFactory</a> configured <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> with a <cite>PropertyNamingStrategy</cite> of <cite>camelCase</cite> as a <cite>Singleton</cite>.</li>
<li>a <a class="reference external" href="https://fasterxml.github.io/jackson-dataformats-text/javadoc/yaml/2.11/com/fasterxml/jackson/dataformat/yaml/YAMLFactory.html">YAMLFactory</a> configured <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> with a <cite>PropertyNamingStrategy</cite> of <cite>snake_Case</cite> as a <cite>Singleton</cite>.</li>
</ul>
<p>Since the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/YamlScalaObjectMapperModule.scala"><cite>YamlScalaObjectMapperModule</cite></a> is an extension of the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> is can be
used in place of the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> where a <a class="reference external" href="https://yaml.org/">YAML</a> object mapper
is desired.</p>
</div>
</div>
<div class="section" id="adding-a-custom-serializer-or-deserializer">
<h2>Adding a Custom Serializer or Deserializer<a class="headerlink" href="#adding-a-custom-serializer-or-deserializer" title="Permalink to this headline">¶</a></h2>
<p>To register a custom serializer or deserializer, configure any custom serializer or deserializer
via the methods provided by the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>.</p>
<ul>
<li><p class="first">Create a new Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/Module.java">com.fasterxml.jackson.databind.Module</a> implementation.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>To implement a new Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/Module.java">Module</a> for adding a basic custom serializer or deserializer, you can
use the <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/module/SimpleModule.java">com.fasterxml.jackson.databind.module.SimpleModule</a>.</p>
<p>Note, that if you want to register a <cite>JsonSerializer</cite> or <cite>JsonDeserializer</cite> over a parameterized
type, such as a <cite>Collection[T]</cite> or <cite>Map[T, U]</cite>, that you should instead implement
<a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/deser/Deserializers.java">com.fasterxml.jackson.databind.deser.Deserializers</a>
or <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/ser/Serializers.java">com.fasterxml.jackson.databind.ser.Serializers</a>
which provide callbacks to match the full signatures of the class to deserialize into via a
Jackson <cite>JavaType</cite>.</p>
<p class="last">Also note that with this usage it is generally recommended to add your <cite>Serializers</cite> or
<cite>Deserializers</cite> implementation via a <a class="reference external" href="https://github.com/FasterXML/jackson-module-scala"><cite>jackson-module-scala</cite></a> <a class="reference external" href="https://github.com/FasterXML/jackson-module-scala/blob/master/src/main/scala/com/fasterxml/jackson/module/scala/JacksonModule.scala">JacksonModule</a>.
(which is an extension of <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/Module.java">com.fasterxml.jackson.databind.Module</a>
and can thus be used in place). See example below.</p>
</div>
</li>
<li><p class="first">Add your serializer or deserializer using the <cite>SimpleModule#addSerializer</cite> or <cite>SimpleModule#addDeserializer</cite> methods in your module.</p>
</li>
<li><p class="first">In your custom <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> extension, add the Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/Module.java">Module</a> implementation to list of additional Jackson modules by overriding and implementing the <cite>ScalaObjectMapperModule#additionalJacksonModules</cite>.</p>
</li>
</ul>
<p>For example: first create the serializer or deserializer (a deserializer example is shown below)</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.fasterxml.jackson.databind.JsonDeserializer
import com.fasterxml.jackson.databind.deser.Deserializers

// custom deserializer
class FooDeserializer extends JsonDeserializer[Foo] {
  override def deserialize(...)
}

// custom parameterized deserializer
class MapIntIntDeserializer extends JsonDeserializer[Map[Int, Int]] {
  override def deserialize(...)
}

// custom parameterized deserializer resolver
class MapIntIntDeserializerResolver extends Deserializers.Base {
  override def findBeanDeserializer(
    javaType: JavaType,
    config: DeserializationConfig,
    beanDesc: BeanDescription
  ): MapIntIntDeserializer = {
    if (javaType.isMapLikeType &amp;&amp; javaType.hasGenericTypes &amp;&amp; hasIntTypes(javaType)) {
      new MapIntIntDeserializer
    } else null
  }

  private[this] def hasIntTypes(javaType: JavaType): Boolean = {
    val k = javaType.containedType(0)
    val v = javaType.containedType(1)
    k.isPrimitive &amp;&amp; k.getRawClass == classOf[Integer] &amp;&amp;
      v.isPrimitive &amp;&amp; v.getRawClass == classOf[Integer]
  }
}
</pre></div>
</div>
<p>Then add via a Jackson <cite>SimpleModule</cite> or a <a class="reference external" href="https://github.com/FasterXML/jackson-module-scala"><cite>jackson-module-scala</cite></a> <cite>JacksonModule</cite>:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.fasterxml.jackson.databind.module.SimpleModule
import com.fasterxml.jackson.module.scala.JacksonModule

// Jackson SimpleModule for custom deserializer
class FooDeserializerModule extends SimpleModule {
  addDeserializer(FooDeserializer)
}

// Jackson Module Scala JacksonModule for custom deserializer
class MapIntIntDeserializerModule extends JacksonModule {
  override def getModuleName: String = this.getClass.getName

  this += {
    _.addDeserializers(new MapIntIntDeserializerResolver)
  }
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is also important to note that <a class="reference external" href="https://github.com/FasterXML/jackson-databind">Jackson</a>
Modules are <strong>not</strong> Google <a class="reference external" href="https://github.com/google/guice">Guice</a> Modules but are instead
interfaces for extensions that can be registered with a Jackson <cite>ObjectMapper</cite> in order to
provide a well-defined set of extensions to default functionality. In this way, they are similar
in concept to Google <a class="reference external" href="https://github.com/google/guice">Guice</a> Modules, but for configuring an
<cite>ObjectMapper</cite> instead of an <cite>Injector</cite>.</p>
</div>
<p>Lastly, add the custom serializer or deserializer to your customized Finatra <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>:</p>
<p>For more information see the Jackson documentation for
<a class="reference external" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers">Custom Serializers</a>.</p>
<p>You would then use this module in your server. See the <a class="reference external" href="../getting-started/modules.html#module-configuration-in-servers">Modules Configuration in Servers</a>
or the HTTP Server <a class="reference external" href="../http/server.html#framework-modules">Framework Modules</a> for more information
on how to make use of any custom <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>.</p>
</div>
<div class="section" id="improved-case-class-deserializer">
<h2>Improved <cite>case class</cite> deserializer<a class="headerlink" href="#improved-case-class-deserializer" title="Permalink to this headline">¶</a></h2>
<p>The TwitterUtil <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> provides a custom <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/caseclass/CaseClassDeserializer.scala">case class deserializer</a>
which overcomes some limitations in <a class="reference external" href="https://github.com/FasterXML/jackson-module-scala"><cite>jackson-module-scala</cite></a> and it is worth understanding some its
features:</p>
<ul class="simple">
<li>Throws a <cite>JsonMappingException</cite> when required fields are missing from the parsed JSON.</li>
<li>Uses specified <cite>case class</cite> default values when fields are missing in the incoming JSON.</li>
<li>Properly deserializes a <cite>Seq[Long]</cite> (see: <a class="reference external" href="https://github.com/FasterXML/jackson-module-scala/issues/62">https://github.com/FasterXML/jackson-module-scala/issues/62</a>).</li>
<li>Supports <a class="reference external" href="https://docs.scala-lang.org/overviews/core/value-classes.html">“wrapped values”</a> using <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/WrappedValue.scala">c.t.util.jackson.WrappedValue</a>.</li>
<li>Support for field and method level validations via integration with the <a class="reference external" href="https://twitter.github.io/util/guide/util-validator/index.html">util-validator</a> Bean Validation 2.0 style validations during JSON deserialization.</li>
<li>Accumulates all JSON deserialization errors (instead of failing fast) in a returned sub-class of <cite>JsonMappingException</cite> (see: <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/caseclass/exceptions/CaseClassMappingException.scala">CaseClassMappingException</a>).</li>
</ul>
<p>The <cite>case class</cite> deserializer is added by default when constructing a new <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Note: with the TwitterUtil <cite>case class</cite> deserializer, non-option fields without default values are
<strong>considered required</strong>.</p>
<p class="last">If a required field is missing, a <cite>CaseClassMappingException</cite> is thrown.</p>
</div>
</div>
<div class="section" id="jackson-injectablevalues-support">
<h2>Jackson InjectableValues Support<a class="headerlink" href="#jackson-injectablevalues-support" title="Permalink to this headline">¶</a></h2>
<p>By default, the Finatra provides a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> via the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> configured
to resolve Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/InjectableValues.java">InjectableValues</a>
via a given Google <a class="reference external" href="https://github.com/google/guice">Guice</a> <a class="reference external" href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Injector.html">Injector</a>.</p>
<p>The default is very similar to the <a class="reference external" href="https://github.com/FasterXML/jackson-modules-base/tree/master/guice">jackson-module-guice</a> –
<a class="reference external" href="https://github.com/FasterXML/jackson-modules-base/blob/master/guice/src/main/java/com/fasterxml/jackson/module/guice/GuiceInjectableValues.java">GuiceInjectableValues</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Jackson “InjectableValues” is not related to <a class="reference external" href="../getting-started/basics.html#dependency-injection">Dependency Injection</a>
or Google <a class="reference external" href="https://github.com/google/guice">Guice</a>. It is meant to convey the filling in of a
value in a deserialized object from somewhere other than the incoming JSON. In Jackson parlance,
this is “injection” of a value.</p>
</div>
<p>The Finatra <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/caseclass/GuiceInjectableValues.scala">c.t.finatra.jackson.caseclass.GuiceInjectableValues</a>
allows users to denote fields in the case class to fill with values that come from a configured Google <a class="reference external" href="https://github.com/google/guice">Guice</a>
<a class="reference external" href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Injector.html">Injector</a>
such that you can do this:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import javax.inject.Inject

case class Foo(name: String, description: String, @Inject bar: Bar)
</pre></div>
</div>
<p>That is, annotate the field to inject with either:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.oracle.com/javaee/7/api/index.html?javax/inject/Inject.html">javax.inject.Inject</a>,</li>
<li><a class="reference external" href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Inject.html">com.google.inject.Inject</a>, or</li>
<li><a class="reference external" href="https://fasterxml.github.io/jackson-annotations/javadoc/2.9/index.html?com/fasterxml/jackson/annotation/JacksonInject.html">com.fasterxml.jackson.annotation.JacksonInject</a></li>
</ul>
<p>and the framework will attempt to get an instance of the field type from the Injector with which
the mapper was configured. In this case, the framework would attempt to obtain an instance of <cite>Bar</cite>
from the object graph.</p>
<p>As mentioned, this is essentially the same functionality found in the <a class="reference external" href="https://github.com/FasterXML/jackson-modules-base/tree/master/guice">jackson-module-guice</a>
<a class="reference external" href="https://github.com/FasterXML/jackson-modules-base/blob/master/guice/src/main/java/com/fasterxml/jackson/module/guice/GuiceInjectableValues.java">GuiceInjectableValues</a>
with a key difference being that the Finatra version ensures we do not attempt lookup of a field from
the Guice Injector <strong>unless there is a non-null Guice Injector configured and the field is specifically annotated</strong>
with one of the supporting annotations.</p>
<p>Using the <cite>Foo</cite> case class above, you could then parse incoming JSON with the <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.twitter.finatra.jackson.modules.ScalaObjectMapperModule
import com.twitter.util.jackson.ScalaObjectMapper
import com.twitter.inject.Injector
import com.twitter.inject.app.TestInjector
import javax.inject.Inject

case class Foo(name: String, description: String, @Inject bar: Bar)

val json: String =
  &quot;&quot;&quot;
    |{
    |  “name”: “FooItem”,
    |  “description”: “This is the description for FooItem”
    |}
  &quot;&quot;&quot;.stripMargin

val injector: Injector = TestInjector(???).create
val mapper: ScalaObjectMapper = (new ScalaObjectMapper).objectMapper(injector.underlying)
val foo = mapper.parse[Foo](json)
</pre></div>
</div>
<p>When deserializing the JSON string into an instance of <cite>Foo</cite>, the mapper will attempt to locate an
instance of type <cite>Bar</cite> from the given injector and use it in place of the <cite>bar</cite> field in the <cite>Foo</cite>
case class.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>It is an error to specify multiple field injection annotations on a field, and it is also an
error to use a field injection annotation in conjunction with <strong>any</strong> <a class="reference external" href="https://github.com/FasterXML/jackson-annotations/blob/a991c43a74e4230eb643e380870b503997674c2d/src/main/java/com/fasterxml/jackson/annotation/JacksonAnnotation.java#L9">JacksonAnnotation</a>.</p>
<p class="last">Both of these cases will result in error during deserialization of JSON into the case class when
using the <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>.</p>
</div>
<p>As mentioned, the Finatra HTTP integration provides extended Jackson <cite>InjectableValues</cite> support
specifically for injecting values into a <cite>case class</cite> which can be obtained from different parts of
an HTTP message. This uses the TwitterUtil <a class="reference external" href="http://twitter.github.io/util/guide/util-jackson/index.html#injectablevalue">&#64;InjectableValues</a>
annotation on specific Finatra HTTP request related <a class="reference external" href="../http/requests.html#field-annotations">annotations</a>.</p>
<p>See the <a class="reference external" href="../http/requests.html#field-annotations">HTTP Requests - Field Annotations</a> documentation
for more details on HTTP Message “injectable values”.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>It is important to note that Jackson currently only allows registration of a single <cite>InjectableValues</cite>
implementation for an ObjectMapper.</p>
<p class="last">Thus, if you configure your bound <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> with a different implementation, the
default behavior provided by the Finatra <cite>GuiceInjectableValues</cite> will be overridden.</p>
</div>
</div>
<div class="section" id="id12">
<h2><a class="reference external" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonMixInAnnotations">Mix-in Annotations</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>The Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonMixInAnnotations">Mix-in Annotations</a>
provides a way to associate annotations to classes without needing to modify the target classes
themselves. It is intended to help support 3rd party datatypes where the user cannot modify the
sources to add annotations.</p>
<p>The TwitterUtil <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> supports Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonMixInAnnotations">Mix-in Annotations</a>
for specifying field annotations during deserialization with the <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/caseclass/CaseClassDeserializer.scala">case class deserializer</a>.</p>
<p>For example, to deserialize JSON into the following classes that are not yours to annotate:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>case class Point(x: Int, y: Int) {
  def area: Int = x * y
}

case class Points(points: Seq[Point])
</pre></div>
</div>
<p>However, you want to enforce field constraints with <a class="reference external" href="./validations.html">validations</a>
during deserialization. You can define a <cite>Mix-in</cite>,</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>trait PointMixIn {
  @Min(0) @Max(100) def x: Int
  @Min(0) @Max(100) def y: Int
  @JsonIgnore def area: Int
}
</pre></div>
</div>
<p>Then register this <cite>Mix-in</cite> for the <cite>Point</cite> class type. There are several ways to do this. Generally,
it is recommended to always prefer applying configuration in a custom <cite>ScalaObjectMapperModule</cite> to
ensure usage of a consistently configured mapper across your application.</p>
<div class="section" id="implement-via-a-custom-scalaobjectmappermodule">
<h3>Implement via a Custom <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a><a class="headerlink" href="#implement-via-a-custom-scalaobjectmappermodule" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>First, create a new Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/Module.java">com.fasterxml.jackson.databind.Module</a> implementation. You can use the <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/module/SimpleModule.java">com.fasterxml.jackson.databind.module.SimpleModule</a>.</li>
<li>Add your <cite>MixIn</cite> using the <cite>SimpleModule#setMixInAnnotation</cite> method in your module.</li>
<li>In your custom <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a> extension, add the Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/Module.java">Module</a>.</li>
</ul>
<p>For example, create a new Jackson <cite>SimpleModule</cite>:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.fasterxml.jackson.databind.module.SimpleModule

object PointMixInModule extends SimpleModule {
    setMixInAnnotation(classOf[Point], classOf[PointMixIn]);
}
</pre></div>
</div>
<p>Then add the <cite>SimpleModule</cite> to the list of additional Jackson modules in your custom <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala"><cite>ScalaObjectMapperModule</cite></a>:</p>
<div class="code scala highlight-text notranslate"><div class="highlight"><pre><span></span>import com.twitter.finatra.jackson.modules.ScalaObjectMapperModule

object MyCustomObjectMapperModule extends ScalaObjectMapperModule {
  override val additionalJacksonModules = Seq(PointMixInModule)
}
</pre></div>
</div>
<p>Deserializing this JSON would then error with failed validations:</p>
<div class="code json highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;points&quot;: [
    {&quot;x&quot;: -1, &quot;y&quot;: 120},
    {&quot;x&quot;: 4, &quot;y&quot;: 99}
  ]
}
</pre></div>
</div>
<p>As the first <cite>Point</cite> instance has an x-value less than the minimum of 0 and a y-value greater than
the maximum of 100.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Jackson Integration</a><ul>
<li><a class="reference internal" href="#case-classes">Case Classes</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#twitterutil-scalaobjectmapper">TwitterUtil <cite>ScalaObjectMapper</cite></a><ul>
<li><a class="reference internal" href="#c-t-f-jackson-modules-scalaobjectmappermodule">c.t.f.jackson.modules.ScalaObjectMapperModule</a></li>
<li><a class="reference internal" href="#c-t-f-jackson-modules-yamlscalaobjectmappermodule">c.t.f.jackson.modules.YamlScalaObjectMapperModule</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-custom-serializer-or-deserializer">Adding a Custom Serializer or Deserializer</a></li>
<li><a class="reference internal" href="#improved-case-class-deserializer">Improved <cite>case class</cite> deserializer</a></li>
<li><a class="reference internal" href="#jackson-injectablevalues-support">Jackson InjectableValues Support</a></li>
<li><a class="reference internal" href="#id12">Mix-in Annotations</a><ul>
<li><a class="reference internal" href="#implement-via-a-custom-scalaobjectmappermodule">Implement via a Custom <cite>ScalaObjectMapperModule</cite></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User’s Guide</a><ul>
      <li>Previous: <a href="../validation/index.html" title="previous chapter">Validation Framework Integration</a></li>
      <li>Next: <a href="routing.html" title="next chapter">JSON Integration with HTTP Routing</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2013-2021 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>