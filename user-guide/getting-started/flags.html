
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Flags &#8212; Finatra 20.4.0 documentation</title>
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Future Gotchas" href="futures.html" />
    <link rel="prev" title="Binding Annotations" href="binding_annotations.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="futures.html" title="Future Gotchas"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="binding_annotations.html" title="Binding Annotations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User’s Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="flags">
<span id="id1"></span><h1>Flags<a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h1>
<p>Finatra builds on the support of <a class="reference external" href="https://github.com/twitter/util">TwitterUtil</a> <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala">Flags</a>
from <a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#flags">TwitterServer</a>, adding the
ability to inject Flag values into your classes.</p>
<p>Flags by their definition represent some external configuration that is passed to the server and are
thus an excellent way to parameterize configuration that may be environment specific, e.g., a
database host or URL that is different per environment: <em>production</em>, <em>staging</em>, <em>development</em>, or
<em>jills-staging</em>. This allows you to work with the same application code in different environments.</p>
<p>This type of configuration parameterization is generally preferred over hardcoding logic by a type
of “<em>environment</em>” string within code, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="nv">env</span> <span class="o">==</span> <span class="s2">&quot;production&quot;</span><span class="o">)</span> <span class="o">{</span> ... <span class="o">}</span>
</pre></div>
</div>
<p>It is generally good practice to make Flags <em>granular</em> controls that are  fully orthogonal to one
another. They can then be independently managed for each deploy and this scales consistently as the
number of supported  “environments” scales.</p>
<div class="section" id="global-flags">
<h2>Global Flags<a class="headerlink" href="#global-flags" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/twitter/util">TwitterUtil</a> <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala">Flags</a>
also has the concept of a “global” flag. That is, a flag that is “global” to the JVM process (as it is
generally defined as a Scala object). In the discussion of Flags with Finatra we <strong>do not</strong> mean
“global” flags unless it is explicitly stated.</p>
<p>See the <a class="reference external" href="https://twitter.github.io/util/docs/com/twitter/app/GlobalFlag.html">scaladoc</a> for
<cite>c.t.app.GlobalFlag</cite> for more information.</p>
</div>
<div class="section" id="but-i-have-a-lot-of-flags">
<h2>But I have a lot of Flags<a class="headerlink" href="#but-i-have-a-lot-of-flags" title="Permalink to this headline">¶</a></h2>
<p>If you find that you end up with a lot of Flags to configure for your service and your deployment
system provides no relief – there are still alternatives to moving external configuration into code.</p>
<p>See <a class="reference external" href="https://groups.google.com/forum/#!searchin/finatra-users/typesafe$20config%7Csort:relevance/finatra-users/kkZgI5dG9CY/lzDPAmUxAwAJ">this thread</a>
on using <a class="reference external" href="https://github.com/lightbend/config">Lightbend Config</a> with Finatra.</p>
</div>
<div class="section" id="when-are-flags-parsed">
<h2>When Are Flags Parsed?<a class="headerlink" href="#when-are-flags-parsed" title="Permalink to this headline">¶</a></h2>
<p>It is important to understand <em>when</em> in the application lifecycle Flag values are parsed from commmand
line input into an instance of the the Flag’s defined <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flag.scala#L55">Flaggable[T]</a> type <cite>T</cite>.</p>
<p>Flags are parsed <em>after</em> the <cite>c.t.app.App#init</cite> application lifecycle phase and <em>before</em> the <cite>c.t.app.App#premain</cite>
lifecycle phase. Thus, you should not attempt to access a Flag value before it is parsed (doing so will cause an
<cite>IllegalStateException</cite> with Finatra as the framework sets the <cite>c.t.app.Flags#failFastUntilParsed</cite> as mentioned
in the <a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#flags">TwitterServer documentation</a>
to <a class="reference external" href="#failfastonflagsnotparsed">true</a>).</p>
<p>That is, Flags are not parsed during class loading or initialization and thus care should be taken when
attempting to eagerly access a Flag value to ensure it is not done until at least the <strong>premain</strong> application
lifecycle phase.</p>
<p>For more information on the application lifecycle see the documentation <a class="reference external" href="lifecycle.html">here</a>.</p>
<p>If you rely on the Finatra <a class="reference external" href="#flag-value-injection">integration</a> which makes Flags defined with default
values available for injection, you should not run into any <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flag.scala#L190">“read before parsed”</a>
issues.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If no command line input is given for a defined Flag, accessing the Flag value should still not
occur until after parsing of command line input has been attempted. The <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flags.scala#L89">c.t.app.Flags</a>
instance is stateful and is only fully initialized <em>after parsing</em> of any command line input and thus
Flags should not be considered “ready” for accessing until this step has completed.</p>
<p><strong>Reminder</strong>: parsing of command line input into Flag values happens between the <cite>c.t.app.App#init</cite> and
<cite>c.t.app.App#premain</cite> lifecycle phases.</p>
</div>
<p>If the Flag defines a default, the <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flag.scala#L186">default value</a> will be returned when no command line value is
given. If the Flag is defined without a default and no command line value is given, any attempt to read
the Flag’s value via the <cite>apply()</cite> function will fail with an <cite>IllegalArgumentException</cite>. For more information
on defining and accessing Flags without default values, see <a class="reference external" href="#flags-without-defaults">here</a>.</p>
</div>
<div class="section" id="how-to-define-flags">
<h2>How To Define Flags<a class="headerlink" href="#how-to-define-flags" title="Permalink to this headline">¶</a></h2>
<p>Flags can be <a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/modules/DoEverythingModule.scala#L13">defined</a>
within a <a class="reference external" href="modules.html">Module</a> to allow for scoping of reusable external configuration (since
Modules are meant to be re-usable). Though, you can also choose to define a Flag
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/DoEverythingServer.scala#L22">directly in a server</a>.</p>
<p>When defined within a <a class="reference external" href="modules.html">Module</a>, Flags can be used to aid in the construction of an
instance to be <a class="reference external" href="modules.html#provides">provided to the object graph</a>, e.g., a <cite>DatabaseConnection</cite>
instance with the database URL specified by a Flag. The module is then able to tell the injector how
to provide an instance of this type when necessary by defining an <code class="docutils literal notranslate"><span class="pre">&#64;Provides</span></code> annotated method. More
information on defining Modules can be found <a class="reference external" href="modules.html">here</a>.</p>
<p>In Finatra, we also provide a way to override bound instances in the object graph when testing
through <a class="reference external" href="../testing/index.html#override-modules">Override Modules</a> or by using
<a class="reference external" href="../testing/index.html##embedded-server-bind-t">Embedded Server #bind[T]</a>.</p>
<div class="section" id="flag-definitions">
<h3>Flag Definitions<a class="headerlink" href="#flag-definitions" title="Permalink to this headline">¶</a></h3>
<p>Define a Flag (in this case within a <cite>TwitterModule</cite>)</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.google.inject.Provides</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flag</span>
<span class="k">import</span> <span class="nn">javax.inject.Singleton</span>

<span class="k">class</span> <span class="nc">MyModule</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="n">flag</span><span class="o">(</span><span class="n">name</span> <span class="k">=</span> <span class="s">&quot;key&quot;</span><span class="o">,</span> <span class="n">default</span> <span class="k">=</span> <span class="s">&quot;default&quot;</span><span class="o">,</span> <span class="n">help</span> <span class="k">=</span> <span class="s">&quot;The key to use&quot;</span><span class="o">)</span>

  <span class="nd">@Provides</span>
  <span class="nd">@Singleton</span>
  <span class="k">def</span> <span class="n">providesFoo</span><span class="o">(</span>
    <span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">)</span> <span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">Foo</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In the example above, notice that we do not save a local reference to the created Flag and instead
reference its value in the provider method by use of the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> binding annotation.</p>
<p>As mentioned, a Flag can also be defined within a server (in this case with an <a class="reference external" href="../http/server.html">HttpServer</a>)</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">DoEverythingModule</span>
<span class="k">import</span> <span class="nn">ExampleController</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.http.HttpServer</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.http.filters.</span><span class="o">{</span><span class="nc">CommonFilters</span><span class="o">,</span> <span class="nc">LoggingMDCFilter</span><span class="o">,</span> <span class="nc">TraceIdMDCFilter</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.http.routing.HttpRouter</span>

<span class="k">object</span> <span class="nc">ExampleServerMain</span> <span class="k">extends</span> <span class="nc">ExampleServer</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="o">{</span>

  <span class="n">flag</span><span class="o">(</span><span class="s">&quot;magic.num&quot;</span><span class="o">,</span> <span class="s">&quot;42&quot;</span><span class="o">,</span> <span class="s">&quot;Defines a magic number flag.&quot;</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">val</span> <span class="n">modules</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">DoEverythingModule</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">configureHttp</span><span class="o">(</span><span class="n">router</span><span class="k">:</span> <span class="kt">HttpRouter</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">router</span>
      <span class="o">.</span><span class="n">filter</span><span class="o">[</span><span class="kt">LoggingMDCFilter</span><span class="o">[</span><span class="kt">Request</span><span class="p">,</span> <span class="kt">Response</span><span class="o">]]</span>
      <span class="o">.</span><span class="n">filter</span><span class="o">[</span><span class="kt">TraceIdMDCFilter</span><span class="o">[</span><span class="kt">Request</span><span class="p">,</span> <span class="kt">Response</span><span class="o">]]</span>
      <span class="o">.</span><span class="n">filter</span><span class="o">[</span><span class="kt">CommonFilters</span><span class="o">]</span>
      <span class="o">.</span><span class="n">add</span><span class="o">[</span><span class="kt">ExampleController</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The parsed value of the Flag, <cite>magic.num</cite> would be available to be injected where necessary using
the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> binding annotation, e.g.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flag</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="o">(</span>
  <span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;magic.num&quot;</span><span class="o">)</span> <span class="n">magicNum</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="flag-annotation">
<h3><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code> annotation<a class="headerlink" href="#flag-annotation" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> <a class="reference external" href="../getting-started/binding_annotations.html">binding annotation</a>.
This annotation allows parsed Flag values to be injected into classes (and provider methods).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>While <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-app/src/main/scala/com/twitter/app/Flag.scala">Flag</a>
supports parsing into any <a class="reference external" href="https://github.com/twitter/util/blob/1bdeab56e49015c1f4c097ef76e47b93a079a239/util-app/src/main/scala/com/twitter/app/Flaggable.scala#L19"><code class="docutils literal notranslate"><span class="pre">Flaggable[T]</span></code></a> type, it is currently only possible to
<em>bind</em> to a <a class="reference external" href="https://github.com/twitter/finatra/blob/31efc1d46dea436fb580f4b71f9196d15bade2e3/inject/inject-app/src/main/scala/com/twitter/inject/app/internal/TwitterTypeConvertersModule.scala">String type</a>
or a type easily convertible from <cite>String</cite>.</p>
<p>Finatra provides <a class="reference external" href="https://github.com/twitter/finatra/blob/31efc1d46dea436fb580f4b71f9196d15bade2e3/inject/inject-app/src/main/scala/com/twitter/inject/app/internal/TwitterTypeConvertersModule.scala">type conversions for</a>
<cite>c.t.util.Duration</cite> and  <cite>org.joda.time.Duration</cite> as well as default conversions provided by
<a class="reference external" href="https://github.com/google/guice">Guice</a> for
<a class="reference external" href="https://github.com/google/guice/blob/55bb902701f6e0277fbfaedd735f4315213957bf/core/src/com/google/inject/internal/TypeConverterBindingProcessor.java#L43">Numbers, Booleans, and Chars</a>.</p>
<p>The reason for this limitation is that when creating the binding key for the Flag value we are
not able to obtain enough type information to properly bind to any paramaterized type like
<cite>Seq[T]</cite> or <cite>Map[K, V]</cite> as the <a class="reference external" href="https://github.com/twitter/util/blob/1bdeab56e49015c1f4c097ef76e47b93a079a239/util-app/src/main/scala/com/twitter/app/Flaggable.scala#L19"><code class="docutils literal notranslate"><span class="pre">Flaggable[T]</span></code></a> trait does not currently carry enough type
information to construct the correct binding key.</p>
</div>
</div>
<div class="section" id="holding-a-reference">
<h3>Holding a Reference<a class="headerlink" href="#holding-a-reference" title="Permalink to this headline">¶</a></h3>
<p>When defining a Flag you can also dereference the Flag value directly within the Module or server
(in lieu of using the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> annotation). However, you should be <strong>extremely cautious</strong> when doing so.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.google.inject.Provides</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>
<span class="k">import</span> <span class="nn">com.foo.bar.ThirdPartyFoo</span>
<span class="k">import</span> <span class="nn">javax.inject.Singleton</span>

<span class="k">object</span> <span class="nc">MyModule1</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">key</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="n">name</span> <span class="k">=</span> <span class="s">&quot;key&quot;</span><span class="o">,</span> <span class="n">default</span> <span class="k">=</span> <span class="s">&quot;default&quot;</span><span class="o">,</span> <span class="n">help</span> <span class="k">=</span> <span class="s">&quot;The key to use&quot;</span><span class="o">)</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesThirdPartyFoo</span><span class="k">:</span> <span class="kt">ThirdPartyFoo</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">ThirdPartyFoo</span><span class="o">(</span><span class="n">key</span><span class="o">())</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This is potentially dangerous. See the next sections for details.</p>
</div>
<div class="section" id="caution">
<h4>Caution<a class="headerlink" href="#caution" title="Permalink to this headline">¶</a></h4>
<p>Note that holding onto a reference of a Flag can be potentially dangerous since Flag definitions
can currently be overridden with another definition. Flags are distinct <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flags.scala#L251">by name only</a>. The Flag you are referencing can be replaced in the stateful <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flags.scala#L89">c.t.app.Flags</a>
instance with another instance created with the same name. The last Flag added wins and thus
when the Flags are parsed your reference may not get a parsed value, resulting in the reference
retaining its default value or no value if it has no specified default.</p>
<p>You should only do this if you are guaranteed that the Flag defined for which you keep a
reference will not be redefined making your reference obselete.</p>
</div>
<div class="section" id="even-more-caution">
<h4>Even More Caution<a class="headerlink" href="#even-more-caution" title="Permalink to this headline">¶</a></h4>
<p>Additionally, having a reference can lead to unintentionally trying to dereference the Flag value
before the command-line value has been parsed. If the Flag has a reasonable default, your code
may even appear to work until the passed command-line value is changed, which will have no effect on
the Flag because the Flag is being evaluated too early in the <a class="reference external" href="./lifecycle.html#c-t-inject-app-app-lifecycle">Application Lifecycle</a>.</p>
<p>The recommendation is to not hold a reference to a create Flag and instead obtain the parsed flag value via
injection. See the <a class="reference external" href="#flag-value-injection">next section</a> on <cite>Flag Value Injection</cite> for details.</p>
</div>
<div class="section" id="ok-but-i-want-to-live-dangerously">
<h4>Ok, But I Want To Live Dangerously<a class="headerlink" href="#ok-but-i-want-to-live-dangerously" title="Permalink to this headline">¶</a></h4>
<p>If you find you must keep a local reference to the created Flag, then you can use the <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L171">Flag#apply</a>,
<a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L205">Flag#get</a>
or other methods, depending, to obtain the parsed Flag value. Again, this is not recommended and caution should be exercised when using flags in this manner to respect the container lifecycle
with regards to <a class="reference external" href="#when-are-flags-parsed">when flags are parsed</a> and other concerns.</p>
</div>
</div>
<div class="section" id="flag-value-injection">
<h3>Flag Value Injection<a class="headerlink" href="#flag-value-injection" title="Permalink to this headline">¶</a></h3>
<p>Flags with a parsed value can be injected as a constructor-arg to a class. When the class is
obtained from the injector the correctly parsed Flag value will be injected.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flag</span>
<span class="k">import</span> <span class="nn">javax.inject.Inject</span>

<span class="k">class</span> <span class="nc">MyService</span> <span class="nd">@Inject</span><span class="o">()(</span>
  <span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">)</span> <span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note, you can also always instantiate the above class manually. When doing so, you will need to pass
all the constructor args manually including a value for the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> annotated argument.</p>
<p>You can also ask the Injector directly for a Flag value using <cite>Flags.named</cite> (similar to Guice’s
<a class="reference external" href="https://github.com/google/guice/blob/master/core/src/com/google/inject/name/Names.java"><cite>Names.named</cite></a>):</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.inject.Injector</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flags</span>

<span class="k">val</span> <span class="n">key</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="n">instance</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="nc">Flags</span><span class="o">.</span><span class="n">named</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">))</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Attempting to get a Flag value from the Injector for a Flag <strong>without</strong> a default
nor a user-specified value will result in a <cite>ProvisionException</cite>.</p>
</div>
</div>
</div>
<div class="section" id="flags-without-defaults">
<h2>Flags Without Defaults<a class="headerlink" href="#flags-without-defaults" title="Permalink to this headline">¶</a></h2>
<p>When creating a Flag, the returned Flag is parameterized to the type of the supplied default
argument, e.g., the method signature looks like this:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.app.</span><span class="o">{</span><span class="nc">Flag</span><span class="o">,</span> <span class="nc">Flaggable</span><span class="o">}</span>

<span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Flaggable</span><span class="o">](</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">default</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">T</span><span class="o">,</span> <span class="n">help</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Flag</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
</pre></div>
</div>
<p>Thus if you do not specify a default value, you must explicitly parameterize calling
<cite>flag()</cite> with a defined type <cite>T</cite>, e.g,</p>
<div class="section" id="a-bad-example">
<h3>A Bad Example<a class="headerlink" href="#a-bad-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.foo.bar.ThirdPartyFoo</span>
<span class="k">import</span> <span class="nn">com.google.inject.Provides</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>
<span class="k">import</span> <span class="nn">javax.inject.Singleton</span>

<span class="k">object</span> <span class="nc">MyModule1</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">key</span> <span class="k">=</span> <span class="n">flag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">name</span> <span class="k">=</span> <span class="s">&quot;key&quot;</span><span class="o">,</span> <span class="n">help</span> <span class="k">=</span> <span class="s">&quot;The key to use&quot;</span><span class="o">)</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesThirdPartyFoo</span><span class="k">:</span> <span class="kt">ThirdPartyFoo</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">myKey</span> <span class="k">=</span> <span class="n">key</span><span class="o">.</span><span class="n">get</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">value</span>
      <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="s">&quot;DEFAULT&quot;</span>
    <span class="o">}</span>
    <span class="k">new</span> <span class="nc">ThirdPartyFoo</span><span class="o">(</span><span class="n">myKey</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Keep in mind that the specified <cite>T</cite> in this case must be a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-app/src/main/scala/com/twitter/app/Flaggable.scala">Flaggable</a>
type. <cite>Flag#get</cite> will return a <cite>None</cite> when no value is passed on the command line for a Flag with no
default.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note: this is not a recommended way of defining or using a Flag within a TwitterModule but is
included to show aspects of the Flag API. Please see the section on why <a class="reference external" href="#holding-a-reference">holding a reference</a> to a Flag in a Module is dangerous and why this is not recommended.</p>
</div>
<p>Note that you should not call <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L171">Flag#apply</a>
on a Flag without a default (as this will result in an <cite>IllegalArgumentException</cite>) but instead use
<a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L205">Flag#get</a> or <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L213">Flag#getWithDefault</a>
which return an <cite>Option[T]</cite> on which you can then pattern match.</p>
</div>
<div class="section" id="injection">
<h3>Injection<a class="headerlink" href="#injection" title="Permalink to this headline">¶</a></h3>
<p>Flags without a default nor a user-supplied value will fail injection (since deferencing the value in this case results in an <cite>IllegalArgumentException</cite>). This means if you try to inject the value of a non-defaulted Flag that has not been supplied a value from the command-line using the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> binding annotation, a <cite>ProvisionException</cite> will be thrown caused by the <cite>IllegalArgumentException</cite> <a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/inject/inject-app/src/main/scala/com/twitter/inject/app/internal/FlagsModule.scala#L34">here</a>.</p>
</div>
<div class="section" id="a-better-example">
<h3>A Better Example<a class="headerlink" href="#a-better-example" title="Permalink to this headline">¶</a></h3>
<p>A better example of injecting a Flag value from a Flag defined without a default:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.foo.bar.ThirdPartyFoo</span>
<span class="k">import</span> <span class="nn">com.google.inject.Provides</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flag</span>
<span class="k">import</span> <span class="nn">javax.inject.Singleton</span>

<span class="k">object</span> <span class="nc">MyModule1</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="n">flag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">name</span> <span class="k">=</span> <span class="s">&quot;key&quot;</span><span class="o">,</span> <span class="n">help</span> <span class="k">=</span> <span class="s">&quot;The key to use&quot;</span><span class="o">)</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesThirdPartyFoo</span><span class="o">(</span><span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">)</span> <span class="n">myKey</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">ThirdPartyFoo</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">ThirdPartyFoo</span><span class="o">(</span><span class="n">myKey</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In this example, we are assured that we will have the parsed value obtained from the injector
in our <cite>&#64;Provides</cite>-annotated method. If there is no supplied command-line value this will fail
as mentioned previously at server startup with a <cite>ProvisionException</cite>.</p>
</div>
</div>
<div class="section" id="passing-flag-values-as-command-line-arguments">
<h2>Passing Flag Values as Command-Line Arguments<a class="headerlink" href="#passing-flag-values-as-command-line-arguments" title="Permalink to this headline">¶</a></h2>
<p>Flags are set by passing them as arguments to your java application. E.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ java -jar finatra-http-server-assembly-2.0.0.jar -key<span class="o">=</span>value
</pre></div>
</div>
<p>An example of this is passing the <cite>-help</cite> Flag to see usage for running a Finatra server, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ java -jar finatra-http-server-assembly-2.0.0.jar -help
HelloWorldServer
  -alarm_durations<span class="o">=</span><span class="s1">&#39;1.seconds,5.seconds&#39;</span>: <span class="m">2</span> alarm durations
  -help<span class="o">=</span><span class="s1">&#39;false&#39;</span>: Show this <span class="nb">help</span>
  -admin.port<span class="o">=</span><span class="s1">&#39;:8080&#39;</span>: Admin http server port
  -bind<span class="o">=</span><span class="s1">&#39;:0&#39;</span>: Network interface to use
  -log.level<span class="o">=</span><span class="s1">&#39;INFO&#39;</span>: Log level
  -log.output<span class="o">=</span><span class="s1">&#39;/dev/stderr&#39;</span>: Output file
  -key<span class="o">=</span><span class="s1">&#39;default&#39;</span>: The key to use
</pre></div>
</div>
</div>
<div class="section" id="c-t-app-flags-failfastonflagsnotparsed">
<h2><code class="docutils literal notranslate"><span class="pre">c.t.app.Flags#failfastOnFlagsNotParsed</span></code><a class="headerlink" href="#c-t-app-flags-failfastonflagsnotparsed" title="Permalink to this headline">¶</a></h2>
<p>Note that Finatra defaults the <cite>c.t.app.Flags#failfastOnFlagsNotParsed</cite> option as mentioned in the
<a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#flags">TwitterServer documentation</a> to
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/inject/inject-server/src/main/scala/com/twitter/inject/server/TwitterServer.scala#L61">true</a>
for you.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important to note that this setting only applies directly to flags created within an application or a
server – since they are directly created from the container’s <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-app/src/main/scala/com/twitter/app/Flags.scala">c.t.app.Flags</a> collection.</p>
<p>Flags created within a Finatra <cite>TwitterModule</cite> are added to the container’s <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-app/src/main/scala/com/twitter/app/Flags.scala">c.t.app.Flags</a> collection in the <cite>init</cite>
<a class="reference external" href="./lifecycle.html#c-t-inject-app-app-lifecycle">Application Lifecycle</a> phase which means that they are currently
created with the default “failFast” behavior for Flags – which is to warn only. Once added to the container’s
collection of Flags, they are updated with the containers value for this setting.</p>
<p>Thus, we recommend caution when creating and <a class="reference external" href="#holding-a-reference">holding onto a reference</a> of a flag in
a Finatra <cite>TwitterModule</cite>.</p>
</div>
</div>
<div class="section" id="modules-depending-on-other-modules-flags-edition">
<h2>Modules Depending on Other Modules - Flags Edition<a class="headerlink" href="#modules-depending-on-other-modules-flags-edition" title="Permalink to this headline">¶</a></h2>
<p>As we saw in the <a class="reference external" href="modules.html#modules-depending-on-other-modules">Modules section</a>, Modules can
“depend” on other Modules. In that case we wanted an already bound type for use in another Module.</p>
<p>Flags are special since they are bound to the object graph by the framework due to the fact that
their values are parsed from the command line at a specific point in the server lifecycle.But the
principle is the same. What if we have a Module which defines a configuration Flag that is useful
in other contexts?</p>
<p>As an example, let’s assume we have a Module which defines a Flag for the service’s “Client Id”
String – how it identifies itself as a client to other services – that is necessary for
constructing different clients:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>

<span class="k">object</span> <span class="nc">ClientIdModule</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="n">flag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;client.id&quot;</span><span class="o">,</span> <span class="s">&quot;System-wide client id for identifying this server as a client to other services.&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>You could choose to build and provide every client which needs the <cite>client.id</cite> Flag value in the
same Module, e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.google.inject.Provides</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>
<span class="k">import</span> <span class="nn">javax.inject.Singleton</span>

<span class="k">object</span> <span class="nc">ClientsModule</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">clientIdFlag</span> <span class="k">=</span> <span class="n">flag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;client.id&quot;</span><span class="o">,</span> <span class="s">&quot;System-wide client id for identifying this server as a client to other services.&quot;</span><span class="o">)</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesClientA</span><span class="k">:</span> <span class="kt">ClientA</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">ClientA</span><span class="o">(</span><span class="n">clientIdFlag</span><span class="o">())</span>
  <span class="o">}</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesClientB</span><span class="k">:</span> <span class="kt">ClientB</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">ClientB</span><span class="o">(</span><span class="n">clientIdFlag</span><span class="o">())</span>
  <span class="o">}</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesClientC</span><span class="k">:</span> <span class="kt">ClientC</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">ClientA</span><span class="o">(</span><span class="n">clientIdFlag</span><span class="o">())</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Or you could choose to break up the client creation into separate Modules – allowing them to be
used and tested independently. If you do the latter, how do you get access to the parsed <cite>client.id</cite>
Flag value from the <cite>ClientIdModule</cite> inside of another Module?</p>
<p>Most often you are trying to inject the Flag value into a class using the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a>
<a class="reference external" href="binding_annotations.html">binding annotation</a> on a class constructor-arg. E.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flag</span>
<span class="k">import</span> <span class="nn">javax.inject.</span><span class="o">{</span><span class="nc">Inject</span><span class="o">,</span> <span class="nc">Singleton</span><span class="o">}</span>

<span class="nd">@Singleton</span>
<span class="k">class</span> <span class="nc">MyClassFoo</span> <span class="nd">@Inject</span><span class="o">()</span> <span class="o">(</span>
  <span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;client.id&quot;</span><span class="o">)</span> <span class="n">clientId</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">???</span>
<span class="o">}</span>
</pre></div>
</div>
<p>You can do something similar in a Module. However, instead of the injection point being the
constructor annotated with <code class="docutils literal notranslate"><span class="pre">&#64;Inject</span></code>, it is the argument list of any <code class="docutils literal notranslate"><span class="pre">&#64;Provides</span></code>-annotated
method.</p>
<p>E.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.google.inject.Provides</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.TwitterModule</span>
<span class="k">import</span> <span class="nn">com.twitter.inject.annotations.Flag</span>
<span class="k">import</span> <span class="nn">javax.inject.Singleton</span>

<span class="k">object</span> <span class="nc">ClientAModule</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">modules</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="nc">ClientIdModule</span><span class="o">)</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesClientA</span><span class="o">(</span>
    <span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;client.id&quot;</span><span class="o">)</span> <span class="n">clientId</span><span class="o">)</span><span class="k">:</span> <span class="kt">ClientA</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">ClientA</span><span class="o">(</span><span class="n">clientId</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>What’s happening here?</p>
<p>Firstly, we’ve defined a <cite>ClientAModule</cite> and override the <cite>modules</cite> val to be a <cite>Seq</cite> of Modules
that includes the <cite>ClientIdModule</cite>. This guarantees that if the <cite>ClientIdModule</cite> is not mixed into
the list of Modules for a server, the <cite>ClientAModule</cite> ensures it will be installed since it’s
declared as a dependency.</p>
<p>This ensures that there will be a bound value for the <cite>ClientId</cite> Flag. Otherwise, our Module
definition is brittle in that we are trying to make use of a Flag which may never be defined
within the scope of our server. With TwitterUtil Flags, trying to use an undefined Flag
<a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flags.scala#L118">could cause your server to fail to start</a>.</p>
<p>Thus we want to ensure that:</p>
<ol class="loweralpha simple">
<li><p>we are only using Flags we define in our Module or</p></li>
<li><p>we include the Module that does.</p></li>
</ol>
<p>Note that it is an <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flags.scala#L251">error to try to define the same Flag twice</a>.</p>
<p>Finatra will de-dupe all Modules before installing, so it is OK if a Module appears twice in the
server configuration, though you should strive to make this the exception.</p>
<p>Secondly, we’ve defined a method which provides a <cite>ClientA</cite>. Since injection is by type (and the
argument list to an <code class="docutils literal notranslate"><span class="pre">&#64;Provides</span></code> annotated method in a Module is an injection point) and <cite>String</cite>
is not specific enough we use the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code></a> <a class="reference external" href="binding_annotations.html">binding annotation</a>.</p>
<p>We could continue this through another Module. For example, if we wanted to provide a <cite>ClientB</cite>
which needs both the <cite>ClientId</cite> and a <cite>ClientA</cite> we could define a <cite>ClientBModule</cite>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">ClientBModule</span> <span class="k">extends</span> <span class="nc">TwitterModule</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">modules</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">ClientIdModule</span><span class="o">,</span>
    <span class="nc">ClientAModule</span><span class="o">)</span>

  <span class="nd">@Singleton</span>
  <span class="nd">@Provides</span>
  <span class="k">def</span> <span class="n">providesClientB</span><span class="o">(</span>
    <span class="nd">@Flag</span><span class="o">(</span><span class="s">&quot;client.id&quot;</span><span class="o">)</span> <span class="n">clientId</span><span class="o">,</span>
    <span class="n">clientA</span><span class="k">:</span> <span class="kt">ClientA</span><span class="o">)</span><span class="k">:</span> <span class="kt">ClientB</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">ClientB</span><span class="o">(</span><span class="n">clientId</span><span class="o">,</span> <span class="n">clientA</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Notice that we choose to list both the <cite>ClientIdModule</cite> and <cite>ClientAModule</cite> in the Modules for the
<cite>ClientBModule</cite>. Yet, since we know that the <cite>ClientAModule</cite> includes the <cite>ClientIdModule</cite> we could
have chosen to leave it out.</p>
<p>The <cite>providesClientB</cite> method in the Module above takes in both a <cite>ClientId</cite> String and a <cite>ClientA</cite>.
Since it declares the two Modules, we’re assured that these types will be available from the
injector for our <cite>providesClientB</cite> method to use.</p>
</div>
<div class="section" id="this-is-just-an-example">
<h2>This is just an Example<a class="headerlink" href="#this-is-just-an-example" title="Permalink to this headline">¶</a></h2>
<p>Note that usage of a <cite>client.id</cite> Flag is just an example. In Finatra, we provide a
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/ThriftClientIdModule.scala">ThriftClientIdModule</a>
for binding a <cite>c.t.finagle.thrift.ClientId</cite> type so that you do not need to rely on the Flag value.</p>
<p>You’ll see that this type is then expected to be bound in other Modules like the
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/FilteredThriftClientModule.scala#L234">FilteredThriftClientModule</a>
which is a utility for building filtered thrift clients.</p>
<p>The framework does not assume that you are using the
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/ThriftClientIdModule.scala">ThriftClientIdModule</a>
for providing the bound <cite>ClientId</cite> type thus the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/FilteredThriftClientModule.scala">FilteredThriftClientModule</a>
does <strong>not</strong> specify the <cite>ThriftClientIdModule</cite> in it’s list of Modules to allow users to bind an
instance of the <cite>ClientId</cite> type in any manner they choose.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Flags</a><ul>
<li><a class="reference internal" href="#global-flags">Global Flags</a></li>
<li><a class="reference internal" href="#but-i-have-a-lot-of-flags">But I have a lot of Flags</a></li>
<li><a class="reference internal" href="#when-are-flags-parsed">When Are Flags Parsed?</a></li>
<li><a class="reference internal" href="#how-to-define-flags">How To Define Flags</a><ul>
<li><a class="reference internal" href="#flag-definitions">Flag Definitions</a></li>
<li><a class="reference internal" href="#flag-annotation"><code class="docutils literal notranslate"><span class="pre">&#64;Flag</span></code> annotation</a></li>
<li><a class="reference internal" href="#holding-a-reference">Holding a Reference</a><ul>
<li><a class="reference internal" href="#caution">Caution</a></li>
<li><a class="reference internal" href="#even-more-caution">Even More Caution</a></li>
<li><a class="reference internal" href="#ok-but-i-want-to-live-dangerously">Ok, But I Want To Live Dangerously</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flag-value-injection">Flag Value Injection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flags-without-defaults">Flags Without Defaults</a><ul>
<li><a class="reference internal" href="#a-bad-example">A Bad Example</a></li>
<li><a class="reference internal" href="#injection">Injection</a></li>
<li><a class="reference internal" href="#a-better-example">A Better Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#passing-flag-values-as-command-line-arguments">Passing Flag Values as Command-Line Arguments</a></li>
<li><a class="reference internal" href="#c-t-app-flags-failfastonflagsnotparsed"><code class="docutils literal notranslate"><span class="pre">c.t.app.Flags#failfastOnFlagsNotParsed</span></code></a></li>
<li><a class="reference internal" href="#modules-depending-on-other-modules-flags-edition">Modules Depending on Other Modules - Flags Edition</a></li>
<li><a class="reference internal" href="#this-is-just-an-example">This is just an Example</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User’s Guide</a><ul>
      <li>Previous: <a href="binding_annotations.html" title="previous chapter">Binding Annotations</a></li>
      <li>Next: <a href="futures.html" title="next chapter">Future Gotchas</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2013-2020 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>