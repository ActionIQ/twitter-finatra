
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HTTP Requests &#8212; Finatra 22.3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HTTP Responses" href="responses.html" />
    <link rel="prev" title="Defining HTTP Controllers" href="controllers.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="responses.html" title="HTTP Responses"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="controllers.html" title="Defining HTTP Controllers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User’s Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="http-requests">
<span id="id1"></span><h1>HTTP Requests<a class="headerlink" href="#http-requests" title="Permalink to this headline">¶</a></h1>
<p>Each Finatra <a class="reference external" href="controllers.html">HTTP Controller</a> route has a callback function which is executed
when the defined route matches an incoming request URI. Callbacks require explicit input types and
Finatra will try to convert the incoming request into the specified input type. Finatra supports three
callback function input types: <a class="reference external" href="#finagle-c-t-finagle-http-request">a Finagle HTTP Request</a>, a
custom <a class="reference external" href="#custom-request-case-class">request case class</a>, or a type parsable by a
<a class="reference external" href="#message-body-components">message body reader</a>. Each are detailed below.</p>
<div class="section" id="finagle-c-t-finagle-http-request">
<h2>Finagle <cite>c.t.finagle.http.Request</cite><a class="headerlink" href="#finagle-c-t-finagle-http-request" title="Permalink to this headline">¶</a></h2>
<p>This is a <a class="reference external" href="https://twitter.github.io/finagle/docs/com/twitter/finagle/http/Request.html">c.t.finagle.http.Request</a>
which contains common HTTP attributes.</p>
</div>
<div class="section" id="custom-request-case-class">
<h2>Custom “request” case class<a class="headerlink" href="#custom-request-case-class" title="Permalink to this headline">¶</a></h2>
<p>Custom “request” case classes can be used for declarative parsing of requests with a content-type of
<cite>application/json</cite> with support for type conversions, default values, and <a class="reference external" href="../json/validations.html">validations</a>.</p>
<p>The case class field names should match the request or header parameter name or use the <a class="reference external" href="https://github.com/FasterXML/jackson-annotations#annotations-for-renaming-properties">&#64;JsonProperty</a>
annotation to specify the JSON field name in the case class (see: <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/test/scala/com/twitter/finatra/json/tests/internal/ExampleCaseClasses.scala#L177">example</a>
and <a class="reference external" href="https://github.com/twitter/finatra/blob/01fdd9cfb3c877fe226085bf411f42ae08420e5d/jackson/src/test/scala/com/twitter/finatra/jackson/tests/AbstractScalaObjectMapperTest.scala#L283">test case</a>).</p>
<p>A <a class="reference external" href="https://fasterxml.github.io/jackson-databind/javadoc/2.3.0/com/fasterxml/jackson/databind/PropertyNamingStrategy.html">PropertyNamingStrategy</a>
can be configured to handle common name substitutions (e.g. <cite>snake_case</cite> or <cite>camelCase</cite>). By default,
<cite>snake_case</cite> is used (defaults are set by the <cite>ScalaObjectMapper</cite> provided by the <a class="reference external" href="https://github.com/twitter/finatra/tree/master/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala">ScalaObjectMapperModule</a>).</p>
<p>For example, if we have a <cite>POST</cite> endpoint which expects a JSON body with a <cite>Long</cite> <cite>“id”</cite> and a
<cite>String</cite> <cite>“name”</cite>, we could define the following case class and Controller route:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">HiRequest</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="o">...</span>

<span class="n">post</span><span class="o">(</span><span class="s">&quot;/hi&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">hiRequest</span><span class="k">:</span> <span class="kt">HiRequest</span> <span class="o">=&gt;</span>
  <span class="s">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">hiRequest</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; with id &quot;</span> <span class="o">+</span> <span class="n">hiRequest</span><span class="o">.</span><span class="n">id</span>
<span class="o">}</span>
</pre></div>
</div>
<p>For the request: <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/hi</span></code></p>
<div class="code json highlight-scala notranslate"><div class="highlight"><pre><span></span>{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Bob&quot;
}
</pre></div>
</div>
<p>The incoming request body will be parsed as JSON using the configured <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>
into the <cite>HiRequest</cite> case class. This route would thus return:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">statuscode 200:</th><td class="field-body"><cite>Hello Bob with id 1</cite></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>More examples in the <a class="reference external" href="../json/routing.html#json-integration-with-routing">JSON Integration with Routing</a>
section.</p>
<p>For more information on configuring the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> see the
<a class="reference external" href="../json/index.html">Jackson Integration</a> section.</p>
<div class="section" id="required-fields">
<h3>Required Fields<a class="headerlink" href="#required-fields" title="Permalink to this headline">¶</a></h3>
<p><strong>Non-option fields without default values are considered required.</strong></p>
<p>If a required field is missing, a <cite>CaseClassMappingException</cite> is thrown.</p>
</div>
<div class="section" id="field-annotations">
<h3>Field Annotations<a class="headerlink" href="#field-annotations" title="Permalink to this headline">¶</a></h3>
<p>Field annotations give signal as to how the framework should parse a case class field member from
the <cite>c.t.finagle.http.Request</cite>. Supported annotations:</p>
<ul class="simple">
<li><a class="reference external" href="#routeparam">&#64;RouteParam</a></li>
<li><a class="reference external" href="#queryparam">&#64;QueryParam</a></li>
<li><a class="reference external" href="#formparam">&#64;FormParam</a></li>
<li><a class="reference external" href="#header">&#64;Header</a></li>
<li><a class="reference external" href="#inject">&#64;Inject</a> (allows for Jackson injection of a value from the object graph).</li>
</ul>
<hr class="docutils" />
<div class="section" id="routeparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/RouteParam.java">&#64;RouteParam</a><a class="headerlink" href="#routeparam" title="Permalink to this headline">¶</a></h4>
<p>Denotes a field to be parsed from a named parameter in a given route, e.g.,</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">FromRouteRequest</span><span class="o">(</span>
  <span class="nd">@RouteParam</span><span class="o">(</span><span class="s">&quot;entity&quot;</span><span class="o">)</span> <span class="n">resource</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="nd">@RouteParam</span> <span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>


<span class="n">get</span><span class="o">(</span><span class="s">&quot;/foo/:entity/:id&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span><span class="k">:</span> <span class="kt">FromRouteRequest</span> <span class="o">=&gt;</span>
  <span class="s">s&quot;The resource is </span><span class="si">${</span><span class="n">request</span><span class="o">.</span><span class="n">resource</span><span class="si">}</span><span class="s"> and the id = </span><span class="si">${</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s">&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Given a request: <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/foo/users/1234</span></code></p>
<p>Using <cite>FromRouteRequest</cite> as an input to the route callback would parse the string “users” into the
value of <cite>FromRouteRequest#resource</cite> and the string “1234” into the value of <cite>FromRouteRequest#id</cite>.</p>
<p>Thus, this route would respond:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">statuscode 200:</th><td class="field-body"><cite>The resource is users and the id = 1234</cite></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/IdAndNameRequest.scala">example</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Route parameter names are case sensitive.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="queryparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/QueryParam.java">&#64;QueryParam</a><a class="headerlink" href="#queryparam" title="Permalink to this headline">¶</a></h4>
<p>Read a value from the request query string by a parameter named for the case class field or by the
<code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code> annotation value.</p>
<p>For example, suppose you want to parse a <cite>GET</cite> request with three query params: <cite>max</cite>, <cite>startDate</cite>,
and <cite>verbose</cite>, e.g.,</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/users?max=10&amp;start_date=2014-05-30TZ&amp;verbose=true</span></code></p>
<p>This can be modeled with the following custom “request” case class which also applies
<a class="reference external" href="../json/validations.html">validations</a>:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">UsersRequest</span><span class="o">(</span>
  <span class="nd">@Max</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span> <span class="nd">@QueryParam</span> <span class="n">max</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
  <span class="nd">@PastDate</span> <span class="nd">@QueryParam</span> <span class="n">startDate</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">DateTime</span><span class="o">],</span>
  <span class="nd">@QueryParam</span> <span class="n">verbose</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>

<span class="n">get</span><span class="o">(</span><span class="s">&quot;/users&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span><span class="k">:</span> <span class="kt">UsersRequest</span> <span class="o">=&gt;</span>
  <span class="o">???</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <cite>max</cite> value will be parsed into an <cite>Int</cite> and <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/main/scala/com/twitter/finatra/json/internal/caseclass/validation/validators/MaxValidator.scala#L49">validated to be less than or equal to
100</a>.
The <cite>startDate</cite> will be parsed into an <cite>Option[DateTime]</cite> (meaning it could be omitted without error
from the query string) and if present will be validated to be a date in the past. Lastly, the
<cite>verbose</cite> parameter will be parsed into a <cite>Boolean</cite> type.</p>
<p>You can also set the parameter name as a value in the <code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code> annotation, e.g.</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">QueryParamRequest</span><span class="o">(</span>
  <span class="nd">@QueryParam</span> <span class="n">foo</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;skip&quot;</span><span class="o">)</span> <span class="n">isSkipped</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span>
</pre></div>
</div>
<p>Using this case class in a route callback for a request:</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/?foo=bar&amp;skip=false</span></code></p>
<p>would parse the string “bar” into the value of <cite>QueryParamRequest#foo</cite> and parse the string “false”
as a Boolean into the <cite>QueryParamRequest#isSkipped</cite> field.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/RequestWithQueryParamSeqString.scala">example</a>.</p>
<p>You can parse comma-separated lists in your query parameters by setting <cite>commaSeparatedList</cite> to <cite>true</cite> in the QueryParam annotation, e.g.</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">ManyUsersRequest</span><span class="o">(</span>
  <span class="nd">@QueryParam</span><span class="o">(</span><span class="n">commaSeparatedList</span><span class="k">=</span><span class="kc">true</span><span class="o">)</span> <span class="n">ids</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span>
</pre></div>
</div>
<p>Using this class in a route callback for a request:</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/?ids=1,2,3</span></code></p>
<p>would split the string “1,2,3” into “1”, “2”, and “3”, and then parse each into a <cite>Long</cite>.</p>
<p>Note that turning this on will disallow repeating the ‘ids’ parameter, ie.</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/?ids=1&amp;ids=2,3</span></code></p>
<p>will return a Bad Request with an appropriate error message when <cite>commaSeparatedList</cite> is <cite>true</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Query parameter names are case sensitive.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="formparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/FormParam.java">&#64;FormParam</a><a class="headerlink" href="#formparam" title="Permalink to this headline">¶</a></h4>
<p>Read a value from a form field with the case class field’s name or as the value specified in the
<code class="docutils literal notranslate"><span class="pre">&#64;FormParam</span></code> annotation from the request body.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/FormPostRequest.scala">example</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Form parameter names are case sensitive.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="header">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/Header.java">&#64;Header</a><a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h4>
<p>Read a header value specified by the case class field name or by the <code class="docutils literal notranslate"><span class="pre">&#64;Header</span></code> annotation value.
You can use a Scala <a class="reference external" href="https://www.scala-lang.org/files/archive/spec/2.11/01-lexical-syntax.html">“back-quote” literal</a>
for the field name when special characters are involved.</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Header</span> <span class="n">`user-agent`</span><span class="k">:</span> <span class="kt">String</span>
</pre></div>
</div>
<p>or specify the header name as a parameter to the <code class="docutils literal notranslate"><span class="pre">&#64;Header</span></code> annotation, e.g.,</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Header</span><span class="o">(</span><span class="s">&quot;user-agent&quot;</span><span class="o">)</span> <span class="n">agent</span><span class="k">:</span> <span class="kt">String</span>
</pre></div>
</div>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/CreateUserRequest.scala">example</a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>Route, query, and form params are all stored in the “params” field of the incoming Finagle http
request. As such, you should ensure that <code class="docutils literal notranslate"><span class="pre">&#64;RouteParam</span></code> names do not collide with <code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code>
names. Otherwise, an <code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code> could end up parsing an <code class="docutils literal notranslate"><span class="pre">&#64;RouteParam</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;FormParam</span></code>
field.</p>
<p>Also note that headers are accessed <strong>case-insensitively</strong>. Thus, the annotated fields:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Header</span><span class="o">(</span><span class="s">&quot;Accept-Charset&quot;</span><span class="o">)</span> <span class="n">acceptCharset</span><span class="k">:</span> <span class="kt">String</span>
<span class="nd">@Header</span><span class="o">(</span><span class="s">&quot;accept-charset&quot;</span><span class="o">)</span> <span class="n">acceptCharset</span><span class="k">:</span> <span class="kt">String</span>
<span class="nd">@Header</span><span class="o">(</span><span class="s">&quot;aCcEpT-cHaRsEt&quot;</span><span class="o">)</span> <span class="n">acceptCharset</span><span class="k">:</span> <span class="kt">String</span>
<span class="nd">@Header</span> <span class="n">`accept-charset`</span><span class="k">:</span> <span class="kt">String</span>
</pre></div>
</div>
<p class="last">would all retrieve <strong>the same value</strong> from the request headers map.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="inject">
<h4>&#64;Inject<a class="headerlink" href="#inject" title="Permalink to this headline">¶</a></h4>
<p>Can be used to inject any <a class="reference external" href="https://github.com/google/guice">Guice</a> managed class into your case
class.</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">InjectedFieldCaseClass</span><span class="o">(</span>
  <span class="nd">@Inject</span> <span class="n">defaultOptString</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
  <span class="nd">@Inject</span> <span class="n">foo</span> <span class="nc">Foo</span><span class="o">)</span>
</pre></div>
</div>
<p>Note, however, it is not necessary to inject the underlying Finagle <cite>http</cite> Request into your
case class. To access the underlying Finagle HTTP Request in your custom case class, simply
include a field of type <cite>c.t.finagle.http.Request</cite> and the framework will properly inject the
incoming request into your custom case class, for example:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.finagle.http.Request</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">CaseClassWithRequestField</span><span class="o">(</span>
 <span class="nd">@Header</span><span class="o">(</span><span class="s">&quot;user-agent&quot;</span><span class="o">)</span> <span class="n">agent</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
 <span class="nd">@QueryParam</span> <span class="n">verbose</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span>
 <span class="n">request</span><span class="k">:</span> <span class="kt">Request</span><span class="o">)</span>
</pre></div>
</div>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/RequestWithInjections.scala">example</a>.</p>
<hr class="docutils" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>HTTP requests with a content-type of <cite>application/json</cite> sent to routes with a custom request
case class callback input type will <strong>always trigger</strong> the parsing of the request body as
well-formed JSON in attempt to convert the JSON into the request case class.</p>
<p class="last">This behavior can be disabled by annotating the case class with <code class="docutils literal notranslate"><span class="pre">&#64;JsonIgnoreBody</span></code> leaving the
raw request body accessible by simply adding a member of type <cite>c.t.finagle.http.Request</cite> as
mentioned above.</p>
</div>
<p>For more specifics on how JSON parsing integrates with routing see the
<a class="reference external" href="../json/routing.html">JSON Integration with Routing</a> in the <a class="reference external" href="../json/index.html">JSON</a>
documentation.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It is an error to specify multiple field annotations on a single case class field, and it is also an
error to use a field annotation in conjunction with <strong>any</strong> <a class="reference external" href="https://github.com/FasterXML/jackson-annotations/blob/a991c43a74e4230eb643e380870b503997674c2d/src/main/java/com/fasterxml/jackson/annotation/JacksonAnnotation.java#L9">JacksonAnnotation</a>.</p>
<p class="last">Both of these cases will result in error during deserialization of JSON into the case class.</p>
</div>
</div>
<div class="section" id="injectablevalues">
<h4>InjectableValues<a class="headerlink" href="#injectablevalues" title="Permalink to this headline">¶</a></h4>
<p>These annotations are implemented via a Finatra HTTP integration with Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/InjectableValues.java">InjectableValues</a>
implemented in the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/internal/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a>
class.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/internal/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a>
is only configured via the framework’s <a class="reference external" href="./message_body.html#id2">DefaultMessageBodyReader</a>
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/internal/marshalling/DefaultMessageBodyReaderImpl.scala">DefaultMessageBodyReaderImpl</a>
which is bound in the <a class="reference external" href="./message_body.html#id5">MessageBodyModule</a>.</p>
<p>Thus, attempting to use the HTTP-specific field annotations with a <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>
instance <strong>will not work</strong>.</p>
<p>That is, trying to deserialize JSON into a case class that has fields annotated with
<cite>&#64;QueryParam</cite>, <cite>&#64;RouteParam</cite>, <cite>&#64;FormParam</cite> or <cite>&#64;Header</cite> with an instance of the
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> will not properly inject those fields from a given HTTP message.</p>
<p class="last">This injection will only happen properly through usage of the Finatra framework’s
<a class="reference external" href="./message_body.html#id2">DefaultMessageBodyReader#parse</a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="message-body-components">
<h2>Message Body Components<a class="headerlink" href="#message-body-components" title="Permalink to this headline">¶</a></h2>
<p>Finatra also provides a way to specify how to parse the request into a callback function input via a
<a class="reference external" href="message_body.html#message-body-readers">Message Body Reader</a>. Similar to <a class="reference external" href="#custom-request-case-class">custom request case
classes</a> (which are implemented with a framework
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/internal/marshalling/DefaultMessageBodyReaderImpl.scala">default message body reader</a>),
these objects allow for customized parsing the full incoming <cite>c.t.finagle.http.Request</cite> into a
specific type. For more information, see the <a class="reference external" href="./message_body.html#message-body-readers">Message Body Readers</a>
section.</p>
</div>
<div class="section" id="request-forwarding">
<h2>Request Forwarding<a class="headerlink" href="#request-forwarding" title="Permalink to this headline">¶</a></h2>
<p>You can forward a request to another controller. This is similar to other frameworks where
forwarding will re-use the same request as opposed to issuing a redirect which will force a client
to issue a new request.</p>
<p>To forward, you need to include a <cite>c.t.finatra.http.request.HttpForward</cite> instance in your controller,
e.g.,</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.finagle.http.Request</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.http.Controller</span>

<span class="k">class</span> <span class="nc">MyController</span> <span class="nd">@Inject</span><span class="o">()(</span>
  <span class="n">forward</span><span class="k">:</span> <span class="kt">HttpForward</span><span class="o">)</span>
  <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>
</pre></div>
</div>
<p>Then, to use in your route:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">get</span><span class="o">(</span><span class="s">&quot;/foo&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span><span class="k">:</span> <span class="kt">Request</span> <span class="o">=&gt;</span>
  <span class="n">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="s">&quot;/bar&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Forwarded requests will bypass the server defined filter chain (as the requests have already passed
through the filter chain) but will still pass through controller defined filters.</p>
<p>For example, if a route is defined:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">filter</span><span class="o">[</span><span class="kt">MyAwesomeFilter</span><span class="o">].</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;/bar&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span><span class="k">:</span> <span class="kt">Request</span> <span class="o">=&gt;</span>
  <span class="s">&quot;Hello, world.&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When another controller forwards to this route, <cite>MyAwesomeFilter</cite> will be executed on the forwarded
request.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>By default Finatra sets a maximum forward depth of 5. This value is configurable by setting the
<cite>HttpRouter#withMaxRequestForwardingDepth</cite>. This helps prevent a given request from being
forwarded in an infinite loop.</p>
<p>In the example below, the server has been setup to allow a request to forward a maximum of 10 times.</p>
<div class="code scala last highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">override</span> <span class="k">def</span> <span class="n">configureHttp</span><span class="o">(</span><span class="n">router</span><span class="k">:</span> <span class="kt">HttpRouter</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">router</span>
    <span class="o">.</span><span class="n">withMaxRequestForwardingDepth</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
    <span class="o">.</span><span class="n">add</span><span class="o">[</span><span class="kt">MyController</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multipart-requests">
<h2>Multipart Requests<a class="headerlink" href="#multipart-requests" title="Permalink to this headline">¶</a></h2>
<p>Finatra has support for multi-part requests. Here’s an example of a multi-part <cite>POST</cite> controller
route definition that simply returns all of the keys in the multi-part request:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/multipartParamsEcho&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span><span class="k">:</span> <span class="kt">Request</span> <span class="o">=&gt;</span>
  <span class="nc">RequestUtils</span><span class="o">.</span><span class="n">multiParams</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="n">keys</span>
<span class="o">}</span>
</pre></div>
</div>
<p>An example of testing this endpoint:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">deserializeRequest</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">requestBytes</span> <span class="k">=</span> <span class="nc">IOUtils</span><span class="o">.</span><span class="n">toByteArray</span><span class="o">(</span><span class="n">getClass</span><span class="o">.</span><span class="n">getResourceAsStream</span><span class="o">(</span><span class="n">name</span><span class="o">))</span>
  <span class="nc">HttpCodec</span><span class="o">.</span><span class="n">decodeBytesToRequest</span><span class="o">(</span><span class="n">requestBytes</span><span class="o">)</span>
<span class="o">}</span>

<span class="s">&quot;post multipart&quot;</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">request</span> <span class="k">=</span> <span class="n">deserializeRequest</span><span class="o">(</span><span class="s">&quot;/multipart/request-POST-android.bytes&quot;</span><span class="o">)</span>
  <span class="n">request</span><span class="o">.</span><span class="n">uri</span> <span class="k">=</span> <span class="s">&quot;/multipartParamsEcho&quot;</span>

  <span class="n">server</span><span class="o">.</span><span class="n">httpRequest</span><span class="o">(</span>
    <span class="n">request</span> <span class="k">=</span> <span class="n">request</span><span class="o">,</span>
    <span class="n">suppress</span> <span class="k">=</span> <span class="kc">true</span><span class="o">,</span>
    <span class="n">andExpect</span> <span class="k">=</span> <span class="nc">Ok</span><span class="o">,</span>
    <span class="n">withJsonBody</span> <span class="k">=</span> <span class="s">&quot;&quot;&quot;[&quot;banner&quot;]&quot;&quot;&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="json-patch-requests">
<h2>JSON Patch Requests<a class="headerlink" href="#json-patch-requests" title="Permalink to this headline">¶</a></h2>
<p>Finatra has support for JSON Patch requests, see <a class="reference external" href="https://tools.ietf.org/html/rfc6902">JSON Patch definition</a>.</p>
<p>To handle JSON Patch requests, you will first need to register the <cite>JsonPatchMessageBodyReader</cite> and
the <cite>JsonPatchExceptionMapper</cite> in the server. The <cite>JsonPatchMessageBodyReader</cite> is for parsing JSON
Patch requests as type <cite>c.t.finatra.http.jsonpatch.JsonPatch</cite>, and <cite>JsonPatchExceptionMapper</cite> can
convert JsonPatchExceptions to HTTP responses.</p>
<p>See <a class="reference external" href="exceptions.html">Add an ExceptionMapper</a> for more information on exception mappers.</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.finatra.http.HttpServer</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.http.routing.HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="o">{</span>

 <span class="k">override</span> <span class="k">def</span> <span class="n">configureHttp</span><span class="o">(</span><span class="n">router</span><span class="k">:</span> <span class="kt">HttpRouter</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
   <span class="n">router</span>
     <span class="o">.</span><span class="n">register</span><span class="o">[</span><span class="kt">JsonPatchMessageBodyReader</span><span class="o">]</span>
     <span class="o">.</span><span class="n">exceptionMapper</span><span class="o">[</span><span class="kt">JsonPatchExceptionMapper</span><span class="o">]</span>
     <span class="o">.</span><span class="n">add</span><span class="o">[</span><span class="kt">ExampleController</span><span class="o">]</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Next, you should include a <cite>c.t.finatra.http.jsonpatch.JsonPatchOperator</cite> instance in your controller,
which provides <cite>JsonPatchOperator#toJsonNode</cite> conversions and support for all JSON Patch operations.</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com.twitter.finatra.http.Controller</span>

<span class="k">class</span> <span class="nc">MyController</span> <span class="nd">@Inject</span><span class="o">()(</span>
  <span class="n">jsonPatchOperator</span><span class="k">:</span> <span class="kt">JsonPatchOperator</span>
<span class="o">)</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>
  <span class="o">???</span>
<span class="o">}</span>
</pre></div>
</div>
<p>After the target data has been converted to a JsonNode, just call <cite>JsonPatchUtility.operate</cite> to apply
JSON Patch operations to the target.</p>
<p>For example:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">patch</span><span class="o">(</span><span class="s">&quot;/jsonPatch&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">jsonPatch</span><span class="k">:</span> <span class="kt">JsonPatch</span> <span class="o">=&gt;</span>
  <span class="k">val</span> <span class="n">testCase</span> <span class="k">=</span> <span class="nc">ExampleCaseClass</span><span class="o">(</span><span class="s">&quot;world&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">originalJson</span> <span class="k">=</span> <span class="n">jsonPatchOperator</span><span class="o">.</span><span class="n">toJsonNode</span><span class="o">[</span><span class="kt">ExampleCaseClass</span><span class="o">](</span><span class="n">testCase</span><span class="o">)</span>
  <span class="nc">JsonPatchUtility</span><span class="o">.</span><span class="n">operate</span><span class="o">(</span><span class="n">jsonPatch</span><span class="o">.</span><span class="n">patches</span><span class="o">,</span> <span class="n">jsonPatchOperator</span><span class="o">,</span> <span class="n">originalJson</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>An example of testing this endpoint:</p>
<div class="code scala highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;JsonPatch&quot;</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">request</span> <span class="k">=</span> <span class="nc">RequestBuilder</span><span class="o">.</span><span class="n">patch</span><span class="o">(</span><span class="s">&quot;/jsonPatch&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">body</span><span class="o">(</span>
      <span class="s">&quot;&quot;&quot;[</span>
<span class="s">        |{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/fruit&quot;,&quot;value&quot;:&quot;orange&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;remove&quot;,&quot;path&quot;:&quot;/hello&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;copy&quot;,&quot;from&quot;:&quot;/fruit&quot;,&quot;path&quot;:&quot;/veggie&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;replace&quot;,&quot;path&quot;:&quot;/veggie&quot;,&quot;value&quot;:&quot;bean&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;move&quot;,&quot;from&quot;:&quot;/fruit&quot;,&quot;path&quot;:&quot;/food&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;test&quot;,&quot;path&quot;:&quot;/food&quot;,&quot;value&quot;:&quot;orange&quot;}</span>
<span class="s">        |]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">stripMargin</span><span class="o">,</span>
      <span class="n">contentType</span> <span class="k">=</span> <span class="nc">Message</span><span class="o">.</span><span class="nc">ContentTypeJsonPatch</span><span class="o">)</span>

  <span class="n">server</span><span class="o">.</span><span class="n">httpRequestJson</span><span class="o">[</span><span class="kt">JsonNode</span><span class="o">](</span>
    <span class="n">request</span> <span class="k">=</span> <span class="n">request</span><span class="o">,</span>
    <span class="n">andExpect</span> <span class="k">=</span> <span class="nc">Ok</span><span class="o">,</span>
    <span class="n">withJsonBody</span> <span class="k">=</span> <span class="s">&quot;&quot;&quot;{&quot;food&quot;:&quot;orange&quot;,&quot;veggie&quot;:&quot;bean&quot;}&quot;&quot;&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>For more information and examples, see:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/request/RequestUtils.scala">c.t.finatra.http.request.RequestUtils</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/fileupload/MultipartItem.scala">c.t.finatra.http.fileupload.MultipartItem</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/controllers/DoEverythingController.scala">DoEverythingController</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/test/DoEverythingServerFeatureTest.scala">DoEverythingServerFeatureTest</a></li>
<li><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/request/MultiParamsTest.scala">MultiParamsTest</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTTP Requests</a><ul>
<li><a class="reference internal" href="#finagle-c-t-finagle-http-request">Finagle <cite>c.t.finagle.http.Request</cite></a></li>
<li><a class="reference internal" href="#custom-request-case-class">Custom “request” case class</a><ul>
<li><a class="reference internal" href="#required-fields">Required Fields</a></li>
<li><a class="reference internal" href="#field-annotations">Field Annotations</a><ul>
<li><a class="reference internal" href="#routeparam">&#64;RouteParam</a></li>
<li><a class="reference internal" href="#queryparam">&#64;QueryParam</a></li>
<li><a class="reference internal" href="#formparam">&#64;FormParam</a></li>
<li><a class="reference internal" href="#header">&#64;Header</a></li>
<li><a class="reference internal" href="#inject">&#64;Inject</a></li>
<li><a class="reference internal" href="#injectablevalues">InjectableValues</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#message-body-components">Message Body Components</a></li>
<li><a class="reference internal" href="#request-forwarding">Request Forwarding</a></li>
<li><a class="reference internal" href="#multipart-requests">Multipart Requests</a></li>
<li><a class="reference internal" href="#json-patch-requests">JSON Patch Requests</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User’s Guide</a><ul>
      <li>Previous: <a href="controllers.html" title="previous chapter">Defining HTTP Controllers</a></li>
      <li>Next: <a href="responses.html" title="next chapter">HTTP Responses</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2022 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>