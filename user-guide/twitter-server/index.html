<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating an injectable TwitterServer &#8212; Finatra 18.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '18.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Finatra 18.1.0 documentation" href="../../index.html" />
    <link rel="up" title="User’s Guide" href="../index.html" />
    <link rel="next" title="HTTP Server Definition" href="../http/server.html" />
    <link rel="prev" title="Creating an injectable util-app App" href="../app/index.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../http/server.html" title="HTTP Server Definition"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../app/index.html" title="Creating an injectable util-app App"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User&#8217;s Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="creating-an-injectable-twitterserver">
<h1>Creating an injectable <a class="reference external" href="https://github.com/twitter/twitter-server/blob/develop/server/src/main/scala/com/twitter/server/TwitterServer.scala"><cite>TwitterServer</cite></a><a class="headerlink" href="#creating-an-injectable-twitterserver" title="Permalink to this headline">¶</a></h1>
<p>To create an injectable <a class="reference external" href="https://github.com/twitter/twitter-server/blob/develop/server/src/main/scala/com/twitter/server/TwitterServer.scala"><code class="docutils literal"><span class="pre">c.t.server.TwitterServer</span></code></a>, first depend on the <cite>inject-server</cite> library. Then
use the <a class="reference external" href="../getting-started/framework.html#inject">inject framework</a> to create an injectable
TwitterServer. Finatra provides an injectable version of the <a class="reference external" href="https://github.com/twitter/twitter-server/blob/develop/server/src/main/scala/com/twitter/server/TwitterServer.scala"><code class="docutils literal"><span class="pre">c.t.server.TwitterServer</span></code></a> trait:
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-server/src/main/scala/com/twitter/inject/server/TwitterServer.scala"><code class="docutils literal"><span class="pre">c.t.inject.server.TwitterServer</span></code></a>.</p>
<p>Extending the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-server/src/main/scala/com/twitter/inject/server/TwitterServer.scala"><code class="docutils literal"><span class="pre">c.t.inject.server.TwitterServer</span></code></a> trait creates an injectable <a class="reference external" href="https://github.com/twitter/twitter-server/blob/develop/server/src/main/scala/com/twitter/server/TwitterServer.scala"><cite>TwitterServer</cite></a>.</p>
<p>This allows for the use of <a class="reference external" href="../getting-started/basics.html#dependency-injection">dependency injection</a>
in a <a class="reference external" href="https://github.com/twitter/twitter-server/blob/develop/server/src/main/scala/com/twitter/server/TwitterServer.scala"><cite>TwitterServer</cite></a> with support for <a class="reference external" href="../getting-started/modules.html">modules</a> which allows
for <a class="reference external" href="../testing/index.html#types-of-tests">powerful feature testing</a> of the server.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.inject.Logging
import com.twitter.inject.server.TwitterServer

object MyTwitterServerMain extends MyTwitterServer

class MyTwitterServer
  extends TwitterServer
  with Logging {

  override val modules = Seq(
    MyModule1)

  @Lifecycle
  override protected def postWarmup(): Unit = {
    super.postWarmup()

    // Bind any external interfaces here, register them to be closed on server exit, and add them
    // to the list of awaitables that the server will block on by call the this.await(Awaitable*) method.

    // It is important to remember to NOT BLOCK this method.
  }

  override protected def start(): Unit = {
    // Any additional server startup logic to perform after the server is reported healthy goes here.

    // It is important to remember to NOT BLOCK this method.
  }
}
</pre></div>
</div>
<p>The two points of entry to the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-server/src/main/scala/com/twitter/inject/server/TwitterServer.scala"><code class="docutils literal"><span class="pre">c.t.inject.server.TwitterServer</span></code></a> are the <code class="docutils literal"><span class="pre">#postWarmup</span></code> and <code class="docutils literal"><span class="pre">#start</span></code> methods.</p>
</div>
<div class="section" id="twitterserver-postwarmup">
<h2><cite>TwitterServer#postWarmup</cite><a class="headerlink" href="#twitterserver-postwarmup" title="Permalink to this headline">¶</a></h2>
<p>If you look at the <a class="reference external" href="../getting-started/lifecycle.html#startup">Startup Lifecycle</a> you will see that <code class="docutils literal"><span class="pre">postWarmup</span></code> is executed
after server warmup has been performed and thus after <a class="reference external" href="../getting-started/lifecycle.html#application-and-server-lifecycle">object promotion and initial garbage collection</a>,
but before reporting that the server is healthy (via the <a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#admin-http-interface#lifecycle-management">HTTP Admin Interface</a>
<code class="docutils literal"><span class="pre">/health</span></code> endpoint).</p>
<p>In the <a class="reference external" href="../http/server.html"><code class="docutils literal"><span class="pre">HttpServer</span></code></a> and <a class="reference external" href="../thrift/server.html"><code class="docutils literal"><span class="pre">ThriftServer</span></code></a> traits the framework will bind any external interfaces and
perform announcing of the server in <cite>postWarmup</cite> <code class="docutils literal"><span class="pre">&#64;Lifecycle</span></code> method. External interface binding and
announcing is done at this point in the lifecycle such that if binding the external interface to a
port fails, we do not report the server as healthy in the
<a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#admin-http-interface#lifecycle-management">HTTP Admin Interface</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Put any logic to happen before the server is announced as &#8220;healthy&#8221; in the <code class="docutils literal"><span class="pre">postWarmup</span></code> lifecycle method. Typically, this
is any binding of an external interface but could be any logic that must be done to present the server as &#8220;healthy&#8221;.</p>
<p>Remember, that when overriding any <code class="docutils literal"><span class="pre">&#64;Lifecycle</span></code>-annotated method you <strong>MUST</strong> first call <cite>super()</cite> in the method to ensure
the framework lifecycle events happen accordingly.</p>
<p class="last">As with all lifecycle methods, it is important to <strong>not perform any blocking operations</strong> as you will prevent the server
from starting. If there is blocking work that must be done, it is strongly recommended that you perform this work in a
<a class="reference external" href="https://github.com/twitter/util/blob/develop/util-core/src/main/scala/com/twitter/util/FuturePool.scala">FuturePool</a>.
See the Finatra utility: <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/utils/src/main/scala/com/twitter/finatra/utils/FuturePools.scala"><code class="docutils literal"><span class="pre">FuturePools</span></code></a> for creating named pools.</p>
</div>
<p>Any exception thrown from this method will fail the server startup.</p>
</div>
<div class="section" id="twitterserver-start">
<h2><cite>TwitterServer#start</cite><a class="headerlink" href="#twitterserver-start" title="Permalink to this headline">¶</a></h2>
<p>Any logic to be run after the server is reported as healthy, bound to an external interface and fully started is placed in the
<code class="docutils literal"><span class="pre">#start</span></code> method. This is typically starting long live background processes, starting a processor for incoming data from an
external interface (e.g., it should only be started once the external interface has been successfully bound to port and is accepting
traffic), or any other work that must be completed as part of server startup.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Put any work to happen after the server is bound to an external port and announced as healthy in the <code class="docutils literal"><span class="pre">start</span></code> lifecycle method.</p>
<p>Remember, that when overriding any <code class="docutils literal"><span class="pre">&#64;Lifecycle</span></code>-annotated method you <strong>MUST</strong> first call <cite>super()</cite> in the method to ensure
the framework lifecycle events happen accordingly.</p>
<p class="last">As with all lifecycle methods, it is important to <strong>not perform any blocking operations</strong> as you will prevent the server
from starting. If there is blocking work that must be done, it is strongly recommended that you perform this work in a
<a class="reference external" href="https://github.com/twitter/util/blob/develop/util-core/src/main/scala/com/twitter/util/FuturePool.scala">FuturePool</a>.
See the Finatra utility: <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/utils/src/main/scala/com/twitter/finatra/utils/FuturePools.scala"><code class="docutils literal"><span class="pre">FuturePools</span></code></a> for creating named pools.</p>
</div>
<p>Any exception thrown from this method will fail the server startup.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Users should prefer using the <a class="reference external" href="../http/server.html"><code class="docutils literal"><span class="pre">HttpServer</span></code></a> or <a class="reference external" href="../thrift/server.html"><code class="docutils literal"><span class="pre">ThriftServer</span></code></a> traits from <a class="reference external" href="../http/server.html"><cite>finatra-http</cite></a> and
<a class="reference external" href="../thrift/server.html"><cite>finatra-thrift</cite></a> respectively, for serving HTTP or Thrift external interfaces over overriding
lifecycle methods.</p>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>For details see the <a class="reference external" href="../testing/index.html">Testing with Finatra</a> section and the Finatra <a class="reference external" href="https://github.com/twitter/finatra/tree/develop/examples">examples</a> for detailed examples with tests.</p>
</div>
<div class="section" id="more-information">
<h2>More Information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h2>
<p>For more information on the server lifecycle see the <a class="reference external" href="../getting-started/lifecycle.html">Application and Server Lifecycle</a> section
which contains details around the order of lifecycle events during <a class="reference external" href="../getting-started/lifecycle.html#startup">startup</a> and
considerations during <a class="reference external" href="../getting-started/lifecycle.html#shutdown">shutdown</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating an injectable <cite>TwitterServer</cite></a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#twitterserver-postwarmup"><cite>TwitterServer#postWarmup</cite></a></li>
<li><a class="reference internal" href="#twitterserver-start"><cite>TwitterServer#start</cite></a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#more-information">More Information</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User&#8217;s Guide</a><ul>
      <li>Previous: <a href="../app/index.html" title="previous chapter">Creating an injectable <cite>util-app App</cite></a></li>
      <li>Next: <a href="../http/server.html" title="next chapter">HTTP Server Definition</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2013-2018 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>