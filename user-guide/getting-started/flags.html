<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Flags &#8212; Finatra 19.6.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '19.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Finatra 19.6.0 documentation" href="../../index.html" />
    <link rel="up" title="User’s Guide" href="../index.html" />
    <link rel="next" title="Future Gotchas" href="futures.html" />
    <link rel="prev" title="Binding Annotations" href="binding_annotations.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="futures.html" title="Future Gotchas"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="binding_annotations.html" title="Binding Annotations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User&#8217;s Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="flags">
<span id="id1"></span><h1>Flags<a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h1>
<p>Finatra builds on the support of <a class="reference external" href="https://github.com/twitter/util">TwitterUtil</a> <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala">Flags</a>
from <a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#flags">TwitterServer</a>, adding the
ability to inject Flag values into your classes.</p>
<p>Flags by their definition represent some external configuration that is passed to the server and are
thus an excellent way to parameterize configuration that may be environment specific, e.g., a
database host or URL that is different per environment: <em>production</em>, <em>staging</em>, <em>development</em>, or
<em>jills-staging</em>. This allows you to work with the same application code in different environments.</p>
<p>This type of configuration parameterization is generally preferred over hardcoding logic by a type
of &#8220;<em>environment</em>&#8221; string within code, e.g.</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>if (env == &quot;production&quot;) { ... }
</pre></div>
</div>
<p>It is generally good practice to make Flags <em>granular</em> controls that are  fully orthogonal to one
another. They can then be independently managed for each deploy and this scales consistently as the
number of supported  &#8220;environments&#8221; scales.</p>
<div class="section" id="global-flags">
<h2>Global Flags<a class="headerlink" href="#global-flags" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/twitter/util">TwitterUtil</a> <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala">Flags</a>
also has the concept of a &#8220;global&#8221; flag. That is, a flag that is &#8220;global&#8221; to the JVM process (as it is
generally defined as a Scala object). In the discussion of Flags with Finatra we <strong>do not</strong> mean
&#8220;global&#8221; flags unless it is explicitly stated.</p>
<p>See the <a class="reference external" href="https://twitter.github.io/util/docs/com/twitter/app/GlobalFlag.html">scaladoc</a> for
<cite>c.t.app.GlobalFlag</cite> for more information.</p>
</div>
<div class="section" id="but-i-have-a-lot-of-flags">
<h2>But I have a lot of Flags<a class="headerlink" href="#but-i-have-a-lot-of-flags" title="Permalink to this headline">¶</a></h2>
<p>If you find that you end up with a lot of Flags to configure for your service and your deployment
system provides no relief &#8211; there are still alternatives to moving external configuration into code.</p>
<p>See <a class="reference external" href="https://groups.google.com/forum/#!searchin/finatra-users/typesafe$20config%7Csort:relevance/finatra-users/kkZgI5dG9CY/lzDPAmUxAwAJ">this thread</a>
on using <a class="reference external" href="https://github.com/lightbend/config">Lightbend Config</a> with Finatra.</p>
</div>
<div class="section" id="when-are-flags-parsed">
<h2>When Are Flags Parsed?<a class="headerlink" href="#when-are-flags-parsed" title="Permalink to this headline">¶</a></h2>
<p>It is important to understand <em>when</em> in the application lifecycle Flag values are parsed from commmand
line input into an instance of the the Flag&#8217;s defined <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flag.scala#L55">Flaggable[T]</a> type <cite>T</cite>.</p>
<p>Flags are parsed <em>after</em> the <cite>c.t.app.App#init</cite> application lifecycle phase and <em>before</em> the <cite>c.t.app.App#premain</cite>
lifecycle phase. Thus, you should not attempt to access a Flag value before it is parsed (doing so will cause an
<cite>IllegalStateException</cite> with Finatra as the framework sets the <cite>c.t.app.Flags#failFastUntilParsed</cite> as mentioned
in the <a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#flags">TwitterServer documentation</a>
to <a class="reference external" href="#failfastonflagsnotparsed">true</a>).</p>
<p>That is, Flags are not parsed during class loading or initialization and thus care should be taken when
attempting to eagerly access a Flag value to ensure it is not done until at least the <strong>premain</strong> application
lifecycle phase.</p>
<p>For more information on the application lifecycle see the documentation <a class="reference external" href="lifecycle.html">here</a>.</p>
<p>If you rely on the Finatra <a class="reference external" href="#flag-value-injection">integration</a> which makes Flags defined with default
values available for injection, you should not run into any <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flag.scala#L190">&#8220;read before parsed&#8221;</a>
issues.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If no command line input is given for a defined Flag, accessing the Flag value should still not
occur until after parsing of command line input has been attempted. The <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flags.scala#L89">c.t.app.Flags</a>
instance is stateful and is only fully initialized <em>after parsing</em> of any command line input and thus
Flags should not be considered &#8220;ready&#8221; for accessing until this step has completed.</p>
<p class="last"><strong>Reminder</strong>: parsing of command line input into Flag values happens between the <cite>c.t.app.App#init</cite> and
<cite>c.t.app.App#premain</cite> lifecycle phases.</p>
</div>
<p>If the Flag defines a default, the <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flag.scala#L186">default value</a> will be returned when no command line value is
given. If the Flag is defined without a default and no command line value is given, any attempt to read
the Flag&#8217;s value via the <cite>apply()</cite> function will fail with an <cite>IllegalArgumentException</cite>. For more information
on defining and accessing Flags without default values, see <a class="reference external" href="#flags-without-defaults">here</a>.</p>
</div>
<div class="section" id="how-to-define-flags">
<h2>How To Define Flags<a class="headerlink" href="#how-to-define-flags" title="Permalink to this headline">¶</a></h2>
<p>Flags can be <a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/modules/DoEverythingModule.scala#L13">defined</a>
within a <a class="reference external" href="modules.html">Module</a> to allow for scoping of reusable external configuration (since
Modules are meant to be re-usable). Though, you can also choose to define a Flag
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/DoEverythingServer.scala#L22">directly in a server</a>.</p>
<p>When defined within a <a class="reference external" href="modules.html">Module</a>, Flags can be used to aid in the construction of an
instance to be <a class="reference external" href="modules.html#provides">provided to the object graph</a>, e.g., a <cite>DatabaseConnection</cite>
instance with the database URL specified by a Flag. The module is then able to tell the injector how
to provide an instance of this type when necessary by defining an <code class="docutils literal"><span class="pre">&#64;Provides</span></code> annotated method. More
information on defining Modules can be found <a class="reference external" href="modules.html">here</a>.</p>
<p>In Finatra, we also provide a way to override bound instances in the object graph when testing
through <a class="reference external" href="../testing/index.html#override-modules">Override Modules</a> or by using
<a class="reference external" href="../testing/index.html##embedded-server-bind-t">Embedded Server #bind[T]</a>.</p>
<div class="section" id="flag-definitions">
<h3>Flag Definitions<a class="headerlink" href="#flag-definitions" title="Permalink to this headline">¶</a></h3>
<p>Define a Flag (in this case within a <cite>TwitterModule</cite>)</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.google.inject.Provides
import com.twitter.inject.TwitterModule
import com.twitter.inject.annotations.Flag
import javax.inject.Singleton

class MyModule extends TwitterModule {
  flag(name = &quot;key&quot;, default = &quot;default&quot;, help = &quot;The key to use&quot;)

  @Provides
  @Singleton
  def providesFoo(
    @Flag(&quot;key&quot;) key: String) = {
    new Foo(key)
  }
}
</pre></div>
</div>
<p>In the example above, notice that we do not save a local reference to the created Flag and instead
reference its value in the provider method by use of the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> binding annotation.</p>
<p>As mentioned, a Flag can also be defined within a server (in this case with an <a class="reference external" href="../http/server.html">HttpServer</a>)</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import DoEverythingModule
import ExampleController
import com.twitter.finatra.http.HttpServer
import com.twitter.finatra.http.filters.{CommonFilters, LoggingMDCFilter, TraceIdMDCFilter}
import com.twitter.finatra.http.routing.HttpRouter

object ExampleServerMain extends ExampleServer

class ExampleServer extends HttpServer {

  flag(&quot;magic.num&quot;, &quot;42&quot;, &quot;Defines a magic number flag.&quot;)

  override val modules = Seq(
    DoEverythingModule)

  override def configureHttp(router: HttpRouter): Unit = {
    router
      .filter[LoggingMDCFilter[Request, Response]]
      .filter[TraceIdMDCFilter[Request, Response]]
      .filter[CommonFilters]
      .add[ExampleController]
  }
}
</pre></div>
</div>
<p>The parsed value of the Flag, <cite>magic.num</cite> would be available to be injected where necessary using
the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> binding annotation, e.g.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.inject.annotations.Flag

class MyClass(
  @Flag(&quot;magic.num&quot;) magicNum: String
)
</pre></div>
</div>
</div>
<div class="section" id="flag-annotation">
<h3><code class="docutils literal"><span class="pre">&#64;Flag</span></code> annotation<a class="headerlink" href="#flag-annotation" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> <a class="reference external" href="../getting-started/binding_annotations.html">binding annotation</a>.
This annotation allows parsed Flag values to be injected into classes (and provider methods).</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>While <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-app/src/main/scala/com/twitter/app/Flag.scala">Flag</a>
supports parsing into any <a class="reference external" href="https://github.com/twitter/util/blob/1bdeab56e49015c1f4c097ef76e47b93a079a239/util-app/src/main/scala/com/twitter/app/Flaggable.scala#L19"><code class="docutils literal"><span class="pre">Flaggable[T]</span></code></a> type, it is currently only possible to
<em>bind</em> to a <a class="reference external" href="https://github.com/twitter/finatra/blob/31efc1d46dea436fb580f4b71f9196d15bade2e3/inject/inject-app/src/main/scala/com/twitter/inject/app/internal/TwitterTypeConvertersModule.scala">String type</a>
or a type easily convertible from <cite>String</cite>.</p>
<p>Finatra provides <a class="reference external" href="https://github.com/twitter/finatra/blob/31efc1d46dea436fb580f4b71f9196d15bade2e3/inject/inject-app/src/main/scala/com/twitter/inject/app/internal/TwitterTypeConvertersModule.scala">type conversions for</a>
<cite>c.t.util.Duration</cite> and  <cite>org.joda.time.Duration</cite> as well as default conversions provided by
<a class="reference external" href="https://github.com/google/guice">Guice</a> for
<a class="reference external" href="https://github.com/google/guice/blob/55bb902701f6e0277fbfaedd735f4315213957bf/core/src/com/google/inject/internal/TypeConverterBindingProcessor.java#L43">Numbers, Booleans, and Chars</a>.</p>
<p class="last">The reason for this limitation is that when creating the binding key for the Flag value we are
not able to obtain enough type information to properly bind to any paramaterized type like
<cite>Seq[T]</cite> or <cite>Map[K, V]</cite> as the <a class="reference external" href="https://github.com/twitter/util/blob/1bdeab56e49015c1f4c097ef76e47b93a079a239/util-app/src/main/scala/com/twitter/app/Flaggable.scala#L19"><code class="docutils literal"><span class="pre">Flaggable[T]</span></code></a> trait does not currently carry enough type
information to construct the correct binding key.</p>
</div>
</div>
<div class="section" id="holding-a-reference">
<h3>Holding a Reference<a class="headerlink" href="#holding-a-reference" title="Permalink to this headline">¶</a></h3>
<p>When defining a Flag you can also dereference the Flag value directly within the Module or server
(in lieu of using the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> annotation).</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>Note that holding onto a reference of a Flag can be potentially dangerous since Flag definitions
can currently be overridden with another definition. Flags are distinct <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flags.scala#L251">by name only</a>. The Flag you are referencing can be replaced in the stateful <a class="reference external" href="https://github.com/twitter/util/blob/ed6f6a73a41d1b7e8331687567e3191cd5ead19e/util-app/src/main/scala/com/twitter/app/Flags.scala#L89">c.t.app.Flags</a>
instance with another instance created with the same name. The last Flag added wins and thus
when the Flags are parsed your reference may not get a parsed value, resulting in the reference
retaining its default value or no value if it has no specified default.</p>
<p class="last">You should only do this if you are guaranteed that the Flag defined for which you keep a
reference will not be redefined making your reference obselete.</p>
</div>
<p>Keep a local reference to the created Flag then use the <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L171">Flag#apply</a>,
<a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L205">Flag#get</a>
or other methods, depending e.g.:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.google.inject.Provides
import com.twitter.inject.TwitterModule
import com.foo.bar.ThirdPartyFoo
import javax.inject.Singleton

object MyModule1 extends TwitterModule {
  val key = flag(name = &quot;key&quot;, default = &quot;default&quot;, help = &quot;The key to use&quot;)

  @Singleton
  @Provides
  def providesThirdPartyFoo: ThirdPartyFoo = {
    new ThirdPartyFoo(key())
  }
}
</pre></div>
</div>
<p>Again, note that caution should be used when defining flags in this manner.</p>
</div>
<div class="section" id="flag-value-injection">
<h3>Flag Value Injection<a class="headerlink" href="#flag-value-injection" title="Permalink to this headline">¶</a></h3>
<p>Flags specified with defaults can be injected as a constructor-arg to a class. When the class is
obtained from the injector the correctly parsed Flag value will be injected.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.inject.annotations.Flag
import javax.inject.Inject

class MyService @Inject()(
  @Flag(&quot;key&quot;) key: String) {
}
</pre></div>
</div>
<p>Note, you can also always instantiate the above class manually. When doing so, you will need to pass
all the constructor args manually including a value for the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> annotated argument.</p>
<p>You can also ask the Injector directly for a Flag value using <cite>Flags.named</cite> (similar to Guice&#8217;s
<a class="reference external" href="https://github.com/google/guice/blob/master/core/src/com/google/inject/name/Names.java"><cite>Names.named</cite></a>):</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.inject.Injector
import com.twitter.inject.annotations.Flags

val key: String = injector.instance[String](Flags.named(&quot;key&quot;))
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Attempting to get a Flag value from the Injector for a Flag <strong>without</strong> a default value
will result in an <cite>ProvisionException</cite>.</p>
</div>
</div>
</div>
<div class="section" id="flags-without-defaults">
<h2>Flags Without Defaults<a class="headerlink" href="#flags-without-defaults" title="Permalink to this headline">¶</a></h2>
<p>When creating a Flag, the returned Flag is parameterized to the type of the supplied default
argument, e.g., the method signature looks like this:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.app.{Flag, Flaggable}

def apply[T: Flaggable](name: String, default: =&gt; T, help: String): Flag[T]
</pre></div>
</div>
<p>Thus if you do not specify a default value, you must explicitly parameterize calling
<cite>flag()</cite> with a defined type <cite>T</cite>, e.g,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.google.inject.Provides
import com.twitter.inject.TwitterModule
import com.foo.bar.ThirdPartyFoo
import javax.inject.Singleton

object MyModule1 extends TwitterModule {
  val key = flag[String](name = &quot;key&quot;, help = &quot;The key to use&quot;)

  @Singleton
  @Provides
  def providesThirdPartyFoo: ThirdPartyFoo = {
    val myKey = key.get match {
      case Some(value) =&gt; value
      case _ =&gt; &quot;DEFAULT&quot;
    }
    new ThirdPartyFoo(myKey)
  }
}
</pre></div>
</div>
<p>Keep in mind that the specified <cite>T</cite> in this case must be a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-app/src/main/scala/com/twitter/app/Flaggable.scala">Flaggable</a>
type. <cite>Flag#get</cite> will return a <cite>None</cite> when no value is passed on the command line for a Flag with no
default.</p>
<p>Note that you should not call <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L171">Flag#apply</a>
on a Flag without a default (as this will result in an <cite>IllegalArgumentException</cite>) but instead use
<a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flag.scala#L205">Flag#get</a>
which returns an <cite>Option[T]</cite> on which you can then pattern match.</p>
<p>Because Finatra does not currently support binding optional types, Flags without defaults <em>are not
injectable</em> but can still be useful for accepting external configuration to either
<a class="reference external" href="modules.html#using-flags-in-modules">provide instances to the object graph</a> or configure a
server. That is, you can still use these Flags to help in providing other types to the object graph,
or  to configure logic in a server, their values just cannot be obtained from the Injector. You will
want to hold on to a local reference as seen above and use <cite>Flag#get</cite> to obtain a parsed value.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Since Flags without default values are not supported for injection, this means if you try to inject
a non-defaulted Flag instance using the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> binding annotation
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/inject/inject-app/src/main/scala/com/twitter/inject/app/internal/FlagsModule.scala#L34">you will get an IllegalArgumentException</a>
on startup of your application or server.</p>
</div>
</div>
<div class="section" id="passing-flag-values-as-command-line-arguments">
<h2>Passing Flag Values as Command-Line Arguments<a class="headerlink" href="#passing-flag-values-as-command-line-arguments" title="Permalink to this headline">¶</a></h2>
<p>Flags are set by passing them as arguments to your java application. E.g.,</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>$ java -jar finatra-hello-world-assembly-2.0.0.jar -key=value
</pre></div>
</div>
<p>An example of this is passing the <cite>-help</cite> Flag to see usage for running a Finatra server, e.g.</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>$ java -jar finatra-hello-world-assembly-2.0.0.jar -help
HelloWorldServer
  -alarm_durations=&#39;1.seconds,5.seconds&#39;: 2 alarm durations
  -help=&#39;false&#39;: Show this help
  -admin.port=&#39;:8080&#39;: Admin http server port
  -bind=&#39;:0&#39;: Network interface to use
  -log.level=&#39;INFO&#39;: Log level
  -log.output=&#39;/dev/stderr&#39;: Output file
  -key=&#39;default&#39;: The key to use
</pre></div>
</div>
</div>
<div class="section" id="c-t-app-flags-failfastonflagsnotparsed">
<h2><code class="docutils literal"><span class="pre">c.t.app.Flags#failfastOnFlagsNotParsed</span></code><a class="headerlink" href="#c-t-app-flags-failfastonflagsnotparsed" title="Permalink to this headline">¶</a></h2>
<p>Note that Finatra defaults the <cite>c.t.app.Flags#failfastOnFlagsNotParsed</cite> option as mentioned in the
<a class="reference external" href="https://twitter.github.io/twitter-server/Features.html#flags">TwitterServer documentation</a> to
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/inject/inject-server/src/main/scala/com/twitter/inject/server/TwitterServer.scala#L61">true</a>
for you.</p>
</div>
<div class="section" id="modules-depending-on-other-modules-flags-edition">
<h2>Modules Depending on Other Modules - Flags Edition<a class="headerlink" href="#modules-depending-on-other-modules-flags-edition" title="Permalink to this headline">¶</a></h2>
<p>As we saw in the <a class="reference external" href="modules.html#modules-depending-on-other-modules">Modules section</a>, Modules can
&#8220;depend&#8221; on other Modules. In that case we wanted an already bound type for use in another Module.</p>
<p>Flags are special since they are bound to the object graph by the framework due to the fact that
their values are parsed from the command line at a specific point in the server lifecycle.But the
principle is the same. What if we have a Module which defines a configuration Flag that is useful
in other contexts?</p>
<p>As an example, let&#8217;s assume we have a Module which defines a Flag for the service&#8217;s &#8220;Client Id&#8221;
String &#8211; how it identifies itself as a client to other services &#8211; that is necessary for
constructing different clients:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.inject.TwitterModule

object ClientIdModule extends TwitterModule {
  flag[String](&quot;client.id&quot;, &quot;System-wide client id for identifying this server as a client to other services.&quot;)
}
</pre></div>
</div>
<p>You could choose to build and provide every client which needs the <cite>client.id</cite> Flag value in the
same Module, e.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.google.inject.Provides
import com.twitter.inject.TwitterModule
import javax.inject.Singleton

object ClientsModule extends TwitterModule {
  val clientIdFlag = flag[String](&quot;client.id&quot;, &quot;System-wide client id for identifying this server as a client to other services.&quot;)

  @Singleton
  @Provides
  def providesClientA: ClientA = {
    new ClientA(clientIdFlag())
  }

  @Singleton
  @Provides
  def providesClientB: ClientB = {
    new ClientB(clientIdFlag())
  }

  @Singleton
  @Provides
  def providesClientC: ClientC = {
    new ClientA(clientIdFlag())
  }
}
</pre></div>
</div>
<p>Or you could choose to break up the client creation into separate Modules &#8211; allowing them to be
used and tested independently. If you do the latter, how do you get access to the parsed <cite>client.id</cite>
Flag value from the <cite>ClientIdModule</cite> inside of another Module?</p>
<p>Most often you are trying to inject the Flag value into a class using the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a>
<a class="reference external" href="binding_annotations.html">binding annotation</a> on a class constructor-arg. E.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.twitter.inject.annotations.Flag
import javax.inject.{Inject, Singleton}

@Singleton
class MyClassFoo @Inject() (
  @Flag(&quot;client.id&quot;) clientId) {
  ???
}
</pre></div>
</div>
<p>You can do something similar in a Module. However, instead of the injection point being the
constructor annotated with <code class="docutils literal"><span class="pre">&#64;Inject</span></code>, it is the argument list of any <code class="docutils literal"><span class="pre">&#64;Provides</span></code>-annotated
method.</p>
<p>E.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>import com.google.inject.Provides
import com.twitter.inject.TwitterModule
import com.twitter.inject.annotations.Flag
import javax.inject.Singleton

object ClientAModule extends TwitterModule {
  override val modules = Seq(ClientIdModule)

  @Singleton
  @Provides
  def providesClientA(
    @Flag(&quot;client.id&quot;) clientId): ClientA = {
    new ClientA(clientId)
  }
}
</pre></div>
</div>
<p>What&#8217;s happening here?</p>
<p>Firstly, we&#8217;ve defined a <cite>ClientAModule</cite> and override the <cite>modules</cite> val to be a <cite>Seq</cite> of Modules
that includes the <cite>ClientIdModule</cite>. This guarantees that if the <cite>ClientIdModule</cite> is not mixed into
the list of Modules for a server, the <cite>ClientAModule</cite> ensures it will be installed since it&#8217;s
declared as a dependency.</p>
<p>This ensures that there will be a bound value for the <cite>ClientId</cite> Flag. Otherwise, our Module
definition is brittle in that we are trying to make use of a Flag which may never be defined
within the scope of our server. With TwitterUtil Flags, trying to use an undefined Flag
<a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flags.scala#L118">could cause your server to fail to start</a>.</p>
<p>Thus we want to ensure that:</p>
<ol class="loweralpha simple">
<li>we are only using Flags we define in our Module or</li>
<li>we include the Module that does.</li>
</ol>
<p>Note that it is an <a class="reference external" href="https://github.com/twitter/util/blob/1dd3e6228162c78498338b1c3aa11afe2f8cee22/util-app/src/main/scala/com/twitter/app/Flags.scala#L251">error to try to define the same Flag twice</a>.</p>
<p>Finatra will de-dupe all Modules before installing, so it is OK if a Module appears twice in the
server configuration, though you should strive to make this the exception.</p>
<p>Secondly, we&#8217;ve defined a method which provides a <cite>ClientA</cite>. Since injection is by type (and the
argument list to an <code class="docutils literal"><span class="pre">&#64;Provides</span></code> annotated method in a Module is an injection point) and <cite>String</cite>
is not specific enough we use the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-app/src/main/java/com/twitter/inject/annotations/Flag.java"><code class="docutils literal"><span class="pre">&#64;Flag</span></code></a> <a class="reference external" href="binding_annotations.html">binding annotation</a>.</p>
<p>We could continue this through another Module. For example, if we wanted to provide a <cite>ClientB</cite>
which needs both the <cite>ClientId</cite> and a <cite>ClientA</cite> we could define a <cite>ClientBModule</cite>:</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>object ClientBModule extends TwitterModule {
  override val modules = Seq(
    ClientIdModule,
    ClientAModule)

  @Singleton
  @Provides
  def providesClientB(
    @Flag(&quot;client.id&quot;) clientId,
    clientA: ClientA): ClientB = {
    new ClientB(clientId, clientA)
  }
}
</pre></div>
</div>
<p>Notice that we choose to list both the <cite>ClientIdModule</cite> and <cite>ClientAModule</cite> in the Modules for the
<cite>ClientBModule</cite>. Yet, since we know that the <cite>ClientAModule</cite> includes the <cite>ClientIdModule</cite> we could
have chosen to leave it out.</p>
<p>The <cite>providesClientB</cite> method in the Module above takes in both a <cite>ClientId</cite> String and a <cite>ClientA</cite>.
Since it declares the two Modules, we&#8217;re assured that these types will be available from the
injector for our <cite>providesClientB</cite> method to use.</p>
</div>
<div class="section" id="this-is-just-an-example">
<h2>This is just an Example<a class="headerlink" href="#this-is-just-an-example" title="Permalink to this headline">¶</a></h2>
<p>Note that usage of a <cite>client.id</cite> Flag is just an example. In Finatra, we provide a
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/ThriftClientIdModule.scala">ThriftClientIdModule</a>
for binding a <cite>c.t.finagle.thrift.ClientId</cite> type so that you do not need to rely on the Flag value.</p>
<p>You&#8217;ll see that this type is then expected to be bound in other Modules like the
<a class="reference external" href="https://github.com/twitter/finatra/blob/ec8d584eb914f50f92314c740dc68fb7abb47eff/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/FilteredThriftClientModule.scala#L234">FilteredThriftClientModule</a>
which is a utility for building filtered thrift clients.</p>
<p>The framework does not assume that you are using the
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/ThriftClientIdModule.scala">ThriftClientIdModule</a>
for providing the bound <cite>ClientId</cite> type thus the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/inject/inject-thrift-client/src/main/scala/com/twitter/inject/thrift/modules/FilteredThriftClientModule.scala">FilteredThriftClientModule</a>
does <strong>not</strong> specify the <cite>ThriftClientIdModule</cite> in it&#8217;s list of Modules to allow users to bind an
instance of the <cite>ClientId</cite> type in any manner they choose.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Flags</a><ul>
<li><a class="reference internal" href="#global-flags">Global Flags</a></li>
<li><a class="reference internal" href="#but-i-have-a-lot-of-flags">But I have a lot of Flags</a></li>
<li><a class="reference internal" href="#when-are-flags-parsed">When Are Flags Parsed?</a></li>
<li><a class="reference internal" href="#how-to-define-flags">How To Define Flags</a><ul>
<li><a class="reference internal" href="#flag-definitions">Flag Definitions</a></li>
<li><a class="reference internal" href="#flag-annotation"><code class="docutils literal"><span class="pre">&#64;Flag</span></code> annotation</a></li>
<li><a class="reference internal" href="#holding-a-reference">Holding a Reference</a></li>
<li><a class="reference internal" href="#flag-value-injection">Flag Value Injection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flags-without-defaults">Flags Without Defaults</a></li>
<li><a class="reference internal" href="#passing-flag-values-as-command-line-arguments">Passing Flag Values as Command-Line Arguments</a></li>
<li><a class="reference internal" href="#c-t-app-flags-failfastonflagsnotparsed"><code class="docutils literal"><span class="pre">c.t.app.Flags#failfastOnFlagsNotParsed</span></code></a></li>
<li><a class="reference internal" href="#modules-depending-on-other-modules-flags-edition">Modules Depending on Other Modules - Flags Edition</a></li>
<li><a class="reference internal" href="#this-is-just-an-example">This is just an Example</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User&#8217;s Guide</a><ul>
      <li>Previous: <a href="binding_annotations.html" title="previous chapter">Binding Annotations</a></li>
      <li>Next: <a href="futures.html" title="next chapter">Future Gotchas</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2013-2019 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>